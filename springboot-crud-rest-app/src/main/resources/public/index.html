<!DOCTYPE html>
<html ng-app="homeApp" lang="en" xmlns:th="http://www.thymeleaf.org">
  <title>Home</title>
  <meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
<!--Local setup-->
<link rel="stylesheet" href="/css/bootstrap.min.css">
<link rel="stylesheet" href="/css/jquery.dataTables.min.css">
<link rel="stylesheet" href="/css/buttons.dataTables.min.css"> 
<link rel="stylesheet" href="/css/tempusdominus-bootstrap-4.min.css" />
<link rel="stylesheet" href="/css/font-awesome.min.css"> 
<link rel="stylesheet" href="/css/angular-toastr.css" />
<link rel="stylesheet" type="text/css" href="/css/fixedColumns.dataTables.css"/>
<link rel="stylesheet" type="text/css" href="/css/fixedHeader.dataTables.css"/>
<link rel="stylesheet" type="text/css" href="/css/select.dataTables.css"/>
<link rel="stylesheet" type="text/css" href="/css/index.css"/>
<script src="/js/jquery.min.js"></script>
<script src = "/js/jquery.dataTables.min.js"></script>
<script src="/js/bootstrap.min.js"></script>
<script src="/js/angular.min.js"></script>
<script src="/js/angular-resource.js"></script>
<script type="text/javascript" src="/js/angular-datatables.min.js"></script>
<script src="/js/angular-route.js"></script> 
<script src="/js/angular-filter.min.js"></script>
<script src="/js/angular-animate.js"></script>
<script src="/js/moment.js"></script>
<script type="text/javascript" src="/js/tempusdominus-bootstrap-4.min.js"></script>

<script src="/js/dataTables.buttons.min.js"></script>
<script src="/js/buttons.colVis.min.js"></script>
<script src="/js/buttons.flash.min.js"></script>
<script src="/js/jszip.min.js"></script>
<script src="/js/pdfmake.min.js"></script>
<script src="/js/vfs_fonts.js"></script>
<script src="/js/buttons.html5.min.js"></script>
<script src="/js/buttons.print.min.js"></script>
<script src="/js/dataTables.select.js"></script>
<script type="text/javascript" src="/js/dataTables.fixedColumns.js"></script> 
<script type="text/javascript" src="/js/dataTables.fixedHeader.js"></script>
<script type="text/javascript" src="/js/dataTables.lightColumnFilter.min.js"></script>
<script type="text/javascript"src="/js/angular-datatables.select.min.js"></script>
<script src="/js/angular-datatables.fixedcolumns.js"></script>
<script src="/js/angular-datatables.buttons.min.js"></script>
<script type="text/javascript" src="/js/angular-datatables.light-columnfilter.min.js"></script> 
<script src="/js/angular-toastr.tpls.js"></script> 

<!-- For Deployed war-->
 <!--  <link rel="stylesheet" href="/team/css/bootstrap.min.css">
 <link rel="stylesheet" href="/team/css/jquery.dataTables.min.css">
 <link rel="stylesheet" href="/team/css/buttons.dataTables.min.css"> 
<link rel="stylesheet" href="/team/css/tempusdominus-bootstrap-4.min.css" />
 <link rel="stylesheet" href="/team/css/font-awesome.min.css"> 
 <link rel="stylesheet" href="/team/css/angular-toastr.css" />
<link rel="stylesheet" type="text/css" href="/team/css/fixedColumns.dataTables.css"/>
<link rel="stylesheet" type="text/css" href="/team/css/fixedHeader.dataTables.css"/>
<link rel="stylesheet" type="text/css" href="/team/css/select.dataTables.css"/>
<link rel="stylesheet" type="text/css" href="/team/css/index.css"/>
<script src="/team/js/jquery.min.js"></script>
<script src="/team/js/jquery.dataTables.min.js"></script>
<script src="/team/js/bootstrap.min.js"></script>
<script src="/team/js/angular.min.js"></script>
<script src="/team/js/angular-resource.js"></script>
<script type="text/javascript" src="/team/js/angular-datatables.min.js"></script>
<script src="/team/js/angular-route.js"></script> 
<script src="/team/js/angular-filter.min.js"></script>
<script src="/team/js/angular-animate.js"></script>
<script src="/team/js/moment.js"></script>
<script type="text/javascript" src="/team/js/tempusdominus-bootstrap-4.min.js"></script>
<script src="/team/js/dataTables.buttons.min.js"></script>
<script src="/team/js/buttons.colVis.min.js"></script>
<script src="/team/js/buttons.flash.min.js"></script>
<script src="/team/js/jszip.min.js"></script>
<script src="/team/js/pdfmake.min.js"></script>
<script src="/team/js/vfs_fonts.js"></script>
<script src="/team/js/buttons.html5.min.js"></script>
<script src="/team/js/buttons.print.min.js"></script>
<script src="/team/js/dataTables.select.js"></script>
<script type="text/javascript" src="/team/js/dataTables.fixedColumns.js"></script> 
<script type="text/javascript" src="/team/js/dataTables.fixedHeader.js"></script>
<script type="text/javascript" src="/team/js/dataTables.lightColumnFilter.min.js"></script>
<script type="text/javascript" src="/team/js/angular-datatables.select.min.js"></script>
<script src="/team/js/angular-datatables.fixedcolumns.js"></script>
<script src="/team/js/angular-datatables.buttons.min.js"></script>
<script type="text/javascript" src="/team/js/angular-datatables.light-columnfilter.min.js"></script> 
<script src="/team/js/angular-toastr.tpls.js"></script> -->

<body >

<div ng-controller="indexController" style="width: 100%;height: 100%;">

<!--Navbar ng-controller="indexController" -->
 <nav class = "navbar navbar-expand-sm  navbar-dark" style="background: #fff;border-bottom: solid 1px #c5d6de;">
            <a class = "navbar-brand" href = "#">
               <img src = "img/sse.png" 
                  style="width: 73px;height: 28px;" alt = "">
            </a><i class="fa fa-bars fa-2x menu-toggle" aria-hidden="true" style="color: #004587;"></i>
            <ul class = "navbar-nav ml-auto">
              
                <li class="nav-item dropdown">
		        <a class="nav-link dropdown-toggle" id="navbarDropdownMenuLink-4" data-toggle="dropdown"
		          aria-haspopup="true" aria-expanded="false" style="color: #00a8ff;">
		          <i class="fa fa-user-circle fa-2x"></i><span> Profile </span></a>
		        <div class="dropdown-menu dropdown-menu-right dropdown-info" aria-labelledby="navbarDropdownMenuLink-4">
		          <a class="dropdown-item" href="#">My account</a>
		          <a class="dropdown-item" href="#">Log out</a>
		        </div>
		      </li>
 
            </ul>
            
         </nav>

<div id="wrapper" class="active">
      
      <!-- Sidebar -->
      <div id="sidebar-wrapperMain" >
      <ul id="sidebar_menu" class="sidebar-nav">
          <li class="sidebar-brand" ><a class="" href="#" id="home" ng-click="redirectUrl($event)"><i class="fa fa-dashboard subicon"  aria-hidden="true" style="color: #ac6bec;"></i>Dashboard</a></li>
      </ul>
      <ul  class="sidebar-nav">  
	<li class="sidebar-brand" id="customer_master" ng-click="redirectUrl($event)"><a><i class="fa fa-user subicon" aria-hidden="true" style="color: #ac6bec;"></i>Customer</a></li>
	<li class="sidebar-brand" id="vendor_master"  ng-click="redirectUrl($event)"><a><i class="fa fa-user-circle subicon"  style="color: #1b99cf;"></i>Vendor</a></li> 
	<li class="sidebar-brand" id="employee_master" ng-click="redirectUrl($event)" ><a><i class="fa fa-users subicon" aria-hidden="true"  style="color: #f29824;"></i>Employee</a></li> 
	<!-- <li class='sidebar-brand' ><a id="product_master"  ng-click="redirectUrl($event)">Product<i class="fa fa-product-hunt sub_icon" aria-hidden="true"></i></a></li> --> 
	<li class="sidebar-brand" id="vehicle_master" ng-click="redirectUrl($event)"><a><i class="fa fa-truck subicon" aria-hidden="true"  style="color: #46c35f;"></i>TripSheet</a></li>
	<li class="sidebar-brand" id="user_master" ng-click="redirectUrl($event)" style="display: none;"><a><i class="fa fa-user subicon" aria-hidden="true"  style="color: #fa424a;"></i>User</a></li>
	<li class="sidebar-brand" id="userAccess_master" ng-click="redirectUrl($event)" style="display: none;"><a><i class="fa fa-check-square-o subicon" aria-hidden="true"  style="color: #cd6724;"></i>Access</a></li>
	<li class="sidebar-brand" id="billing_master" ng-click="redirectUrl($event)"><a><i class="fa fa-money subicon" aria-hidden="true"  style="color: #21a788;"></i>Billing</a></li>
	<li class="sidebar-brand" id="receipt_master" ng-click="redirectUrl($event)"><a><i class="fa fa-address-book subicon" aria-hidden="true"  style="color: #ff561c;"></i>Receipt</a></li>
	<li class="sidebar-brand" id="voucher_master" ng-click="redirectUrl($event)"><a><i class="fa fa-address-book subicon" aria-hidden="true"  style="color: #46c35f;"></i>Voucher</a></li>
	<li class="sidebar-brand" id="ledger_master" ng-click="redirectUrl($event)"><a><i class="fa fa-address-book subicon" aria-hidden="true"  style="color: #b348ae;"></i>Ledger</a></li>
 	<li class="sidebar-brand" id="logout" ng-click="redirectUrl($event)"><a><i class="fa fa-sign-out subicon" aria-hidden="true"  style="color: #f29824;"></i>Logout</a></li>
      </ul>
        
      </div>
          
      <!-- Page content -->
      <div id="page-content-wrapper">
        <div class="page-content inset">
           <div class="row">
              <div class="col-md-12">
              <div ng-view ></div>
            </div>
          </div> 
         
        </div>
      </div>
      
    </div>
<!-- <div ng-view style="width: 100%;height: 90%;"></div> -->
</div>
<script>
	//	var localurl ="http://localhost:8086/";
 var localurl =location.origin;
var app = angular.module("homeApp", ["angular.filter","ngRoute","ngResource","datatables","datatables.buttons","ngAnimate", "toastr","datatables.fixedcolumns","datatables.light-columnfilter","datatables.select"]);
app.config(['$routeProvider',function($routeProvider) {
    $routeProvider
      .when("/", {
        templateUrl: 'Login.html',
        controller: 'myCtrl'
    }) 
    .when('/Dashboard/:username', {
        templateUrl: 'Dashboard.html',
        controller: 'EmpController'
    })
     .when('/home', {
        templateUrl: 'home.html',
        controller: 'HomeController'
    })
     .when('/customer_master', {
        templateUrl: 'customer.html',
        controller: 'CustomerController'
    })
     .when('/vendor_master', {
        templateUrl: 'vendor.html',
        controller: 'VendorController'
    })
     .when('/employee_master', {
        templateUrl: 'employee.html',
        controller: 'EmployeeController'
    })
     /* .when('/product_master', {
        templateUrl: 'product.html',
        controller: 'ProductController'
    }) */
     .when('/vehicle_master', {
        templateUrl: 'vehicle.html',
        controller: 'VehicleController'
    })
    .when('/userAccess_master', {
        templateUrl: 'userAccess.html',
        controller: 'UserAccessController'
    })
    .when('/billing_master', {
        templateUrl: 'billing.html',
        controller: 'BillingController'
    })
    .when('/receipt_master', {
        templateUrl: 'receipt.html',
        controller: 'ReceiptController'
    })
    .when('/voucher_master', {
        templateUrl: 'voucher.html',
        controller: 'VoucherController'
    })
    .when('/ledger_master', {
        templateUrl: 'ledger.html',
        controller: 'LedgerController'
    })
     .when('/user_master', {
        templateUrl: 'user.html',
        controller: 'UserController'
    });
    /* .voucher_master
    otherwise({
        redirectTo: '/Home'
    }); */
	
	
}]);

/* app.config(function ($qProvider) {
    $qProvider.errorOnUnhandledRejections(false);
}); */
app.controller('indexController',['$scope','$location', "$timeout", function ($scope, $location, $timeout) {
	$scope.user = {
	        username: '',
	        password: ''
	    }
	
	 $scope.redirectUrl= function (data){
		//console.log(data);
		var menuId = data.currentTarget.id;
		if(menuId == "home"){
			 $timeout( function(){
				// angular.element('#navMenu').trigger('click');
				 $location.path("/"+menuId);
				$("#title").text("Home");
				//angular.element('#menuToggle').css('z-index',"0");
		        }, 500 );
		}else if(menuId == "customer_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Customer");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "vendor_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Vendor");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "employee_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Employee");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "product_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Product");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "vehicle_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Vehicle");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "user_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("User");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "userAccess_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("UserAccess");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "billing_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Billing");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "receipt_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Receipt"); 
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
			
		}else if(menuId == "voucher_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Voucher"); 
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}else if(menuId == "ledger_master"){
			$timeout( function(){
				//angular.element('#navMenu').trigger('click');
				$location.path("/"+menuId);
				$("#title").text("Ledger");
				//angular.element('#menuToggle').css('z-index',"0");
	        }, 500);
		}
		$("#wrapper").toggleClass("active");
	} 
}]);
app.controller("myCtrl", ['$scope', '$window','$location','$rootScope', function($scope, $window, $location,$rootScope){
	//$scope.loggedIn = true;    
	//$window.location.href='http://localhost:8086/LoginPage.html';
	  
	}]);
app.controller("EmpController", ['$scope', '$routeParams' ,'$window' ,'$rootScope', function($scope, $routeParams , $window ,$rootScope ){
 

  if( $routeParams.username){
	  //$scope.loggedIn =$rootScope.loggedIn;
	  $scope.loggedIn =true;
	  $scope.username = $routeParams.username;
  }

	  
}]);
app.controller('HomeController', function ($scope, $routeParams,$rootScope) {
	console.log("alert");
	 $scope.logusername = $routeParams.username;
	 $rootScope.loggedIn =false;
});
app.controller('CustomerController',function ($scope,$filter,$http,$location,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder,toastr) {
	scope=$scope;
	$scope.listCustomerJson =[];
	/* $scope.listCustomerJson =[{customerId: "1111",customerName: "Demo",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF",iec: "12354UUFFA",customerDetails:[{ customerAddr: "3,xyz street,mumbai", mobileNo: "123544", phoneNo: "123544",gstin: "12354RTUGF"},{ customerAddr: "3,xyz street,mumbai", mobileNo: "123544", phoneNo: "123544",gstin: "12354RTUGF"}]},
							  {customerId: "2222",customerName: "XYZ",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF" ,iec: "12354UUFFA", customerDetails:[{ customerAddr: "3,xyz street,mumbai", mobileNo: "123544", phoneNo: "123544",gstin: "12354RTUGF"}]},
							  {customerId: "3333",customerName: "ABC",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF" ,iec: "12354UUFFA", customerDetails:[{ customerAddr: "3,abc street,mumbai", mobileNo: "123544", phoneNo: "123544",gstin: "12354RTUGF"}]},
							  {customerId: "4444",customerName: "QWERT",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF" ,iec: "12354UUFFA", customerDetails:[{ customerAddr: "3,sri street,mumbai", mobileNo: "123544", phoneNo: "123544",gstin: "12354RTUGF"}]}]; */				
	//$scope.customerDetails ={customerAddr: "",mobileNo: "",phoneNo: "",GSTIN: ""};
	
							  
	$scope.cm = {};
	$scope.cm.dtCustomer = DTOptionsBuilder.newOptions()
    .withOption('order', [0, 'asc'])
    .withButtons([
      {
        extend: 'collection',
        text: 'Export',
        buttons: [{
            extend: 'copyHtml5',
            title: 'Mylist'
          },
          {
            extend: 'pdfHtml5',
            title: 'My list'
          },
		  {
            extend: 'excel',
            title: 'Excel'
          },
		  {
            extend: 'csv',
            title: 'My list'
          }
        ]
      }
    ]);
	
	$scope.getValid = function(selectedType,data) {
		var checkState = $filter('filter')($scope.listStateJson, {statename: selectedType});
		   
		if(checkState.length!=0){
			 angular.forEach(checkState,function(value,index){
				 if(checkState[index].statename != selectedType){
					 toastr.error('Please Select Listed state');
				    	$scope.item.customerDetails[data].state="";
				    	return ;
				 }
		 })
		    }else if(checkState.length==0){
		    	 toastr.error('Please Select Listed state');
		    	 $scope.item.customerDetails[data].state="";
		    	 return false;
		    }
		} 
$scope.createCust = function() {
$("#custModal").modal("show");
$(".custId").css("display","");
$(".addCust").css("display","block");
$(".updateCust").css("display","none");

//$scope.item = {customername:"",tan:"",kyc:"",pan:"",iec:"",perkmtrs:"",perkmlc2:"",perkmlc4:"",perkmcan6:"",perkmhcv9:"",perkmtrailer:"",fixedamttrs:"",fixedamtlc2:"",fixedamtlc4:"",fixedamtcan6:"",fixedamthcv9:"",fixedamttrailer:""};
$scope.item = {customername:"",tan:"",kyc:"",pan:"",iec:""};
$scope.item.customerDetails = [{customercode:"",branchname:"",customerAddr: "",state:"",mobileNo: "",phoneNo: "",gstin: ""}];
}

$scope.addCustomerDetails = function(data){
	$scope.item.customerDetails.push({customercode:"",branchname:"",customerAddr: "",state:"",mobileNo: "",phoneNo: "",gstin: ""});

}

$scope.deleteCustomerDetails = function(index){
	$scope.item.customerDetails.splice(index,1);

}


$scope.addItem = function(item) {
	
	
	
	 if(item.customername==""){
		 toastr.error('Please enter CustomerName');
		return;
	}/*else if(item.pan==""){
		 toastr.error('Please enter PAN');
		return;
	} else if(item.bankName==""){
		 toastr.error('Please enter Bank Name');
		return;
	}else if(item.branch==""){
		 toastr.error('Please enter Branch');
			return;
	}else if(item.accountNo==""){
		 toastr.error('Please enter Account Number');
			return;
	}else if(item.ifsc==""){
	 toastr.error('Please enter IFSC Code');
		return;
	}else if(item.contactPerson==""){
		 toastr.error('Please enter Contact Person');
		return;
	}else if(item.contactNo==""){
		 toastr.error('Please enter Contact Number');
			return;
	} */
	 else if(item.customerDetails[0].branchname==""){
		 toastr.error('Please enter BranchName');
		return;
	}
	else if(item.customerDetails[0].customercode==""){
		 toastr.error('Please enter CustomerCode');
		return;
	}else if(item.customerDetails[0].customerAddr==""){
		 toastr.error('Please enter Address');
			return;
	}else if(item.customerDetails[0].state==""){
		 toastr.error('Please enter State');
			return;
	}else if(item.customerDetails[0].mobileNo==""){
		 toastr.error('Please enter Mobile No');
			return;
	}else if(item.customerDetails[0].gstin==""){
		 toastr.error('Please enter GSTIN');
			return;
	}else{
	
	var url = localurl +"/api/v1/createcustomer";
	//$scope.listCustomerJson.push(angular.copy(item));
	    $http({
	        method : 'POST',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data added successfully');
	        	$scope.initcust();
	        }, function error(response) {
	        	toastr.success('Sorry,Error occurred while creating customer..');
	          console.log(response.status);
	        });
	    $scope.item = {customername:"",tan:"",kyc:"",pan:"",iec:""};
	    $scope.item.customerDetails=[{customercode:"",branchname:"",customerAddr: "",state:"",mobileNo: "",phoneNo: "",gstin: ""}];
	}
	   
}
$scope.updateItem = function(item) {
 /* for(i in $scope.listCustomerJson) {
                if($scope.listCustomerJson[i].customerId == $scope.item.customerId) {
                    $scope.listCustomerJson[i] = $scope.item;
                }
         } */
         
         
	var url = localurl +"/api/v1/customerupdate";
	//$scope.listCustomerJson.push(angular.copy(item));
	console.log($scope.item);
	    $http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data updated successfully');
	        	$scope.initcust();
	        }, function error(response) {
	        	toastr.success('Data not updated');
	          console.log(response.status);
	        });
         
         
}
$scope.removeItem = function(item){
//$scope.listCustomerJson.splice(index,1);
	console.log(item.id);
	var url=localurl +"/api/v1/customer/"+item.id;
	 $http({
		    method : 'DELETE',
		    url : url,
		   }).then(function successCallback(response) {
			   toastr.success('Data deleted successfully');
			   $scope.initcust();
		   }, function errorCallback(response) {
			   toastr.success('Data not deleted');
		    console.log(response.statusText);
		   });
}
 $scope.editCustomer = function(index){
   $("#custModal").modal("show");
   $(".custId").css("display","none");
   $(".addCust").css("display","none");
   $(".updateCust").css("display","block");
for(i in $scope.listCustomerJson) {
        if($scope.listCustomerJson[i].id == index.id) {
            $scope.item = angular.copy($scope.listCustomerJson[i]);
        }
    }
 }	
 
 $scope.initcust =function(){
	 
	 var url=localurl +"/api/v1/customerlist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listCustomerJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
 }
$scope.initcustState =function(){
	 
	 var url=localurl +"/api/v1/statestaticdata";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listStateJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
 }
 $scope.initcust();
 $scope.initcustState();
});
app.controller('VendorController', function ($scope,$filter,$http,$location,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder,toastr) {
	$scope.listVendorJson=[];
	 /* $scope.listVendorJson =[{vendorid: "1111",vendorName: "Demo",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF",iec: "12354UUFFA",bankName:"ICICI",branch:"Chennai",accountNo:"232434",ifsc:"ICIC0003",contactPerson:"Dinesh",contactNo:"868755487",vendorVehicle:[{drivername: "Siva",mobileno: "234234",vehicleno: "555",vehicleType: "CAN3",FC: "4455",insurance: "555",RCno: "888",roadTax: "33",pollutioncert: "4324",goodPermit: "23423",statePermit: "2342"}],vendorAddress:[{ vendoraddr: "3,xyz street,mumbai", mobileno: "123544", phoneno: "123544",gstin: "12354RTUGF"},{ vendoraddr: "3,xyz street,mumbai", mobileno: "123544", phoneno: "123544",gstin: "12354RTUGF"}]},
	                        {vendorid: "2222",vendorName: "XYZ",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF" ,iec: "12354UUFFA",bankName:"HDFC",branch:"Chennai",accountNo:"232434",ifsc:"ICIC0003",contactPerson:"Dinesh",contactNo:"868755487",vendorVehicle:[{drivername: "Siva",mobileno: "234234",vehicleno: "555",vehicleType: "CAN3",FC: "4455",insurance: "555",RCno: "888",roadTax: "33",pollutioncert: "4324",goodPermit: "23423",statePermit: "2342"}], vendorAddress:[{ vendoraddr: "3,xyz street,mumbai", mobileno: "123544", phoneno: "123544",gstin: "12354RTUGF"}]},
	                        {vendorid: "3333",vendorName: "ABC",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF" ,iec: "12354UUFFA",bankName:"ICICI",branch:"Chennai",accountNo:"232434",ifsc:"ICIC0003",contactPerson:"Dinesh",contactNo:"868755487",vendorVehicle:[{drivername: "Siva",mobileno: "234234",vehicleno: "555",vehicleType: "CAN3",FC: "4455",insurance: "555",RCno: "888",roadTax: "33",pollutioncert: "4324",goodPermit: "23423",statePermit: "2342"}], vendorAddress:[{ vendoraddr: "3,abc street,mumbai", mobileno: "123544", phoneno: "123544",gstin: "12354RTUGF"}]},
	                        {vendorid: "4444",vendorName: "QWERT",pan: "12354EWRWE",tan: "12354DFGDD",kyc: "123544UGDSCF" ,iec: "12354UUFFA",bankName:"AXIS",branch:"Chennai",accountNo:"232434",ifsc:"ICIC0003",contactPerson:"Dinesh",contactNo:"868755487",vendorVehicle:[{drivername: "Siva",mobileno: "234234",vehicleno: "555",vehicleType: "CAN3",FC: "4455",insurance: "555",RCno: "888",roadTax: "33",pollutioncert: "4324",goodPermit: "23423",statePermit: "2342"}], vendorAddress:[{ vendoraddr: "3,sri street,mumbai", mobileno: "123544", phoneno: "123544",gstin: "12354RTUGF"}]}];	 */ 		
	
    $scope.item = {vendorcode:"",vendorname:"",tan:"",kyc:"",pan:"",iec:"",bankName:"",branch:"",accountNo:"",ifsc:"",contactPerson:"",contactNo:""};
    $scope.item.vendorAddress=[{vendoraddrid:"",vendoraddr: "",state:"",mobileno: "",phoneno: "",gstin: ""}];
    $scope.item.vendorvehicle = [{driverName: "",mobileNo: "",vehicleNo: "",vehicleType: "",fc: "",insurance: "",rCNo: "",roadTax: "",pollutioncert: "",goodPermit: "",statePermit: "",fcdate:"",insurancedate:""}];
                        
	$scope.vm = {};
	$scope.vm.dtVendor = DTOptionsBuilder.newOptions()
    .withOption('order', [0, 'asc'])
    .withButtons([
      {
        extend: 'collection',
        text: 'Export',
        buttons: [{
            extend: 'copyHtml5',
            title: 'Mylist'
          },
          {
            extend: 'pdfHtml5',
            title: 'My list'
          },
		  {
            extend: 'excel',
            title: 'Excel'
          },
		  {
            extend: 'csv',
            title: 'My list'
          }
        ]
      }
    ]);
	
$scope.getstateValid = function(selectedType,data) {
	var checkState = $filter('filter')($scope.listvenStateJson, {statename: selectedType});
	    if(checkState.length==0){
	    	toastr.error('Please Select Listed state');
	    	//$scope.vendorDetail.state="";
	    	data.currentTarget.value="";
	    }
	} 
$scope.createVendor = function() {
$("#venModal").modal('show');
$(".venId").css("display","");
$(".addVen").css("display","block");
$(".updateVen").css("display","none");
$scope.item = {vendorcode:"",vendorname:"",tan:"",kyc:"",pan:"",iec:"",bankName:"",branch:"",accountNo:"",ifsc:"",contactPerson:"",contactNo:""};
$scope.item.vendorAddress=[{vendoraddrid:"",vendoraddr: "",state:"",mobileno: "",phoneno: "",gstin: ""}];
$scope.item.vendorvehicle = [{driverName: "",mobileNo: "",vehicleNo: "",vehicleType: "",fc: "",insurance: "",rCNo: "",roadTax: "",pollutioncert: "",goodPermit: "",statePermit: "",fcdate:"",insurancedate:""}];
}

$scope.addVendorDetails = function(data){
	$scope.item.vendorAddress.push({vendoraddrid:"",vendoraddr: "",state:"",mobileno: "",phoneno: "",gstin: ""});

}
$scope.addVendorVehDetails = function(data){
	$scope.item.vendorvehicle.push({driverName: "",mobileNo: "",vehicleNo: "",vehicleType: "",fc: "",insurance: "",rCNo: "",roadTax: "",pollutioncert: "",goodPermit: "",statePermit: "",fcdate:"",insurancedate:""});

}
$scope.deleteVendorVehDetails = function(index){
	$scope.item.vendorvehicle.splice(index,1);

}
$scope.deleteVendorDetails = function(index){
	$scope.item.vendorAddress.splice(index,1);

}
$scope.addItem = function(item) {
	
	if(item.vendorcode==""){
		 toastr.error('Please enter VendorCode');
		return;
	}else if(item.vendorname==""){
		 toastr.error('Please enter VendorName');
		return;
	}else if(item.pan==""){
		 toastr.error('Please enter PAN');
		return;
	}else if(item.bankName==""){
		 toastr.error('Please enter Bank Name');
		return;
	}else if(item.branch==""){
		 toastr.error('Please enter Branch');
			return;
	}else if(item.accountNo==""){
		 toastr.error('Please enter Account Number');
			return;
	}else if(item.ifsc==""){
	 toastr.error('Please enter IFSC Code');
		return;
	}else if(item.contactPerson==""){
		 toastr.error('Please enter Contact Person');
		return;
	}else if(item.contactNo==""){
		 toastr.error('Please enter Contact Number');
			return;
	}else if(item.vendorAddress[0].customerAddr==""){
		 toastr.error('Please enter Address');
			return;
	}else if(item.vendorAddress[0].state==""){
		 toastr.error('Please enter State');
			return;
	}else if(item.vendorAddress[0].mobileno==""){
		 toastr.error('Please enter Mobile No');
			return;
	}else if(item.vendorAddress[0].gstin==""){
		 toastr.error('Please enter GSTIN');
			return;
	}else{
		//$scope.listVendorJson.push(angular.copy(item));
		var url = localurl +"/api/v1/createvendor";
			//$scope.listCustomerJson.push(angular.copy(item));
			    $http({
			        method : 'POST',
			        url : url,
			        data : angular.toJson($scope.item),
			        headers : {
			        'Content-Type' : 'application/json'
			        }
			        }).then(function (response) {
			            //$scope.listCustomerJson = response.data;
			            toastr.success('Data added successfully');
			        	$scope.initven();
			        }, function error(response) {
			        	toastr.success('Data not added');
			          console.log(response.status);
			        });
	    $scope.item = {vendorcode:"",vendorname:"",tan:"",kyc:"",pan:"",iec:"",bankName:"",branch:"",accountNo:"",ifsc:"",contactPerson:"",contactNo:""};
		$scope.item.vendorAddress=[{vendoraddrid:"",vendoraddr: "",state:"",mobileno: "",phoneno: "",gstin: ""}];
		$scope.item.vendorvehicle = [{driverName: "",mobileNo: "",vehicleNo: "",vehicleType: "",fc: "",insurance: "",rCNo: "",roadTax: "",pollutioncert: "",goodPermit: "",statePermit: "",fcdate:"",insurancedate:""}];
	}
	
}
$scope.updateItem = function(item) {
/* for(i in $scope.listVendorJson) {
              if($scope.listVendorJson[i].vendorId == $scope.item.vendorId) {
                  $scope.listVendorJson[i] = $scope.item;
              }
       } */
	var url = localurl +"/api/v1/vendorrupdate";
	//$scope.listCustomerJson.push(angular.copy(item));
	console.log($scope.item);
	    $http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data updated successfully');
	        	$scope.initven();
	        }, function error(response) {
	        	toastr.success('Data not updated');
	          console.log(response.status);
	        });
}
$scope.removeItem = function(item){
//$scope.listVendorJson.splice(index,1);

	console.log(item.id);
	var url=localurl +"/api/v1/vendor/"+item.id;
	 $http({
		    method : 'DELETE',
		    url : url,
		   }).then(function successCallback(response) {
			   toastr.success('Data deleted successfully');
			   $scope.initven();
		   }, function errorCallback(response) {
			   toastr.success('Data not deleted');
		    console.log(response.statusText);
		   });
}
$scope.editVendor = function(index){
 $("#venModal").modal('show');
 $(".venId").css("display","none");
 $(".addVen").css("display","none");
 $(".updateVen").css("display","block");
for(i in $scope.listVendorJson) {
      if($scope.listVendorJson[i].id == index.id) {
          $scope.item = angular.copy($scope.listVendorJson[i]);
      }
  }
}
	
$scope.initven =function(){
	
	 var url=localurl +"/api/v1/vendorlist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listVendorJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
}
$scope.initvenState =function(){
	 
	 var url=localurl +"/api/v1/statestaticdata";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listvenStateJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
}

$scope.initven();
$scope.initvenState();

});
app.controller('EmployeeController', function ($scope ,$http,$location,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder,toastr) {
	 $scope.listEmployeeJson =[];
	/* $scope.listEmployeeJson =[{empid: "1111",empname: "Demo", role: "Supervisor", designation: "GradeA",mobileNo:"34534545",address:"ABC nagar",PAN:"3fsdf4sd",DOB:"22/7/1991",fatherName:"xzsd",salaryPackage:"8000"},
							  {empId: "2222",empName: "XYZ", empRole: "Employee", designation: "GradeB",mobileNo:"34534545",address:"ABC nagar",PAN:"3fsdf4sd",DOB:"22/7/1991",fatherName:"xzsd",salaryPackage:"8000"},
							  {empId: "3333",empName: "ABC", empRole: "Manager", designation: "GradeC",mobileNo:"34534545",address:"ABC nagar",PAN:"3fsdf4sd",DOB:"22/7/1991",fatherName:"xzsd",salaryPackage:"8000"},
							  {empId: "4444",empName: "QWERT", empRole: "Sales Executive", designation: "GradeD",mobileNo:"34534545",address:"ABC nagar",PAN:"3fsdf4sd",DOB:"22/7/1991",fatherName:"xzsd",salaryPackage:"8000"}];	 */			
	$scope.em = {};
	$scope.em.dtOptions = DTOptionsBuilder.newOptions()
    .withOption('order', [0, 'asc'])
    .withButtons([
      {
        extend: 'collection',
        text: 'Export',
        buttons: [{
            extend: 'copyHtml5',
            title: 'Mylist'
          },
          {
            extend: 'pdfHtml5',
            title: 'My list'
          },
		  {
            extend: 'excel',
            title: 'Excel'
          },
		  {
            extend: 'csv',
            title: 'My list'
          }
        ]
      }
    ]);
$scope.createEmp = function() {
$("#empModal").modal('show');
$(".empId").css("display","");
$(".addEmp").css("display","block");
$(".updateEmp").css("display","none");
$scope.item = {};
}
$scope.addItem = function(item) {
	
	var url = localurl +"/api/v1/employees";
	//$scope.listCustomerJson.push(angular.copy(item));
	    $http({
	        method : 'POST',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data added successfully');
	        	$scope.init();
	        }, function error(response) {
	        	toastr.success('Data not added');
	          console.log(response.status);
	        });
$scope.listEmployeeJson.push(item);
$scope.item = {};

}
$scope.updateItem = function(item) {
 /* for(i in $scope.listEmployeeJson) {
                if($scope.listEmployeeJson[i].empid == $scope.item.empid) {
                    $scope.listEmployeeJson[i] = $scope.item;
                }
         } */
         
	var url = localurl +"/api/v1/employeeupdate";
	//$scope.listCustomerJson.push(angular.copy(item));
	console.log($scope.item);
	    $http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data updated successfully');
	        	$scope.init();
	        }, function error(response) {
	        	toastr.success('Data not updated');
	          console.log(response.status);
	        });
}
$scope.removeItem = function(item){
//$scope.listEmployeeJson.splice(index,1);
	console.log(item.id);
	var url=localurl +"/api/v1/employee/"+item.id;
	 $http({
		    method : 'DELETE',
		    url : url,
		   }).then(function successCallback(response) {
			   toastr.success('Data deleted successfully');
			   $scope.init();
		   }, function errorCallback(response) {
			   toastr.success('Data not deleted');
		    console.log(response.statusText);
		   });
}
 $scope.editEmp = function(index){
 
   $("#empModal").modal('show');
   $(".empId").css("display","none");
   $(".addEmp").css("display","none");
   $(".updateEmp").css("display","block");
for(i in $scope.listEmployeeJson) {
        if($scope.listEmployeeJson[i].empid == index.empid) {
            $scope.item = angular.copy($scope.listEmployeeJson[i]);
        }
    }
 }	
 $scope.init =function(){
	 $('#datetimepicker4').datetimepicker({
	        format: 'DD/MM/YYYY'
	    });
	 
	 
	 var url=localurl +"/api/v1/employeelist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listEmployeeJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
 }
 $scope.init();
});
app.controller('ProductController', function ($scope ,$http,$location,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder,toastr) {
	$scope.listProductJson=[];
	/* $scope.listProductJson =[{productCode:"1111",productId: "1111",productName: "WashingMachine", HSNSAC: "4566", TaxType: "0%"},
							  {productCode:"2222",productId: "1223",productName: "Cooler", HSNSAC: "3456", TaxType: "12%"},
							  {productCode:"3333",productId: "3456",productName: "Fan", HSNSAC: "2345", TaxType: "5%"},
							  {productCode:"4444",productId: "5643",productName: "Furniture", HSNSAC: "1234", TaxType: "18%"}];	 */			
	$scope.pm = {};
	$scope.pm.dtProduct = DTOptionsBuilder.newOptions()
    .withOption('order', [0, 'asc'])
    .withButtons([
      {
        extend: 'collection',
        text: 'Export',
        buttons: [{
            extend: 'copyHtml5',
            title: 'Mylist'
          },
          {
            extend: 'pdfHtml5',
            title: 'My list'
          },
		  {
            extend: 'excel',
            title: 'Excel'
          },
		  {
            extend: 'csv',
            title: 'My list'
          }
        ]
      }
    ]);
$scope.createProduct = function() {
$("#prodModal").modal('show');
$(".prodId").css("display","");
$(".addProd").css("display","block");
$(".updateProd").css("display","none");
$scope.item = {};
}
$scope.addItem = function(item) {
	var url = localurl +"/api/v1/createproduct";
	//$scope.listCustomerJson.push(angular.copy(item));
	    $http({
	        method : 'POST',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data added successfully');
	        	$scope.initProduct();
	        }, function error(response) {
	        	toastr.success('Data not added');
	          console.log(response.status);
	        });
//$scope.listProductJson.push(item);
$scope.item = {};

}
$scope.updateItem = function(item) {
/* for(i in $scope.listProductJson) {
               if($scope.listProductJson[i].productCode == $scope.item.productCode) {
                   $scope.listProductJson[i] = $scope.item;
               }
        } */
        
	var url = localurl +"/api/v1/productupdate";
	//$scope.listCustomerJson.push(angular.copy(item));
	console.log($scope.item);
	    $http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data updated successfully');
	        	$scope.initProduct();
	        }, function error(response) {
	        	toastr.success('Data not updated');
	          console.log(response.status);
	        });
}
$scope.removeItem = function(item){
//$scope.listProductJson.splice(index,1);
	console.log(item.id);
	var url=localurl +"/api/v1/product/"+item.id;
	 $http({
		    method : 'DELETE',
		    url : url,
		   }).then(function successCallback(response) {
			   toastr.success('Data deleted successfully');
			   $scope.initProduct();
		   }, function errorCallback(response) {
			   toastr.success('Data not deleted');
		    console.log(response.statusText);
		   });
}
$scope.editProduct = function(index){

  $("#prodModal").modal('show');
  $(".prodId").css("display","none");
  $(".addProd").css("display","none");
  $(".updateProd").css("display","block");
for(i in $scope.listProductJson) {
       if($scope.listProductJson[i].productcode == index.productcode) {
           $scope.item = angular.copy($scope.listProductJson[i]);
       }
   }
}	
$scope.initProduct = function(){
	 var url=localurl +"/api/v1/productlist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listProductJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
}
$scope.initProduct();
});
app.controller('VehicleController', function ($scope, $timeout,$window ,$filter,$http,$location,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder,toastr,multipartForm) {
	$scope.listVehicleJson ={};
	 //$scope.listCustJson=[];
	 //$scope.listVenJson=[];
	 $scope.listdataJson=[];
	 $scope.getTruckType=[];
	 $scope.tempperkmchargevendor="0";
	 $scope.tempfreightAmtCust="0";
	 $scope.tempfreightAmtVen="0";
	 $scope.getTempCustVen={};
	
	 //$scope.vehlistdataJson=[];
	/* $scope.listVehicleJson =[{codeId: "1111",truckNo: "3455", rcno: "4566", fcDate: "23/4/2019", truckType: "Transport truck"},
							  {codeId: "1223",truckNo: "56767", rcno: "3456", fcDate: "23/4/2019", truckType: "Dump truck"},
							  {codeId: "3456",truckNo: "5675", rcno: "2345", fcDate: "23/4/2019", truckType: "Garbage truck"},
							  {codeId: "5643",truckNo: "56756", rcno: "1234", fcDate: "23/4/2019", truckType: "Box truck"}]; */				
	/*$scope.trip = [{loadNo: "1111",tripNo: "2222",origin: "NEEMAM",destination: "EGMORE",invoiceNO: "234322",dateTime: "23/4/2019",truckType: "CAN2",truckNo: "TN2323200",driverName: "Siva",noOfCase: "3",OPKM: "2",CLSKM: "5",diffKM: "4",advance: "500",perKMchargeCustomer: "6.5",perKMchargeVendor: "7.6",profit: "400",tollBill: "654787",policeBill: "57890",freightAmt: "700",haltingCharge: "700",remarks: "good"},
					{loadNo: "1111",tripNo: "2222",origin: "NEEMAM",destination: "EGMORE",invoiceNO: "234322",dateTime: "23/4/2019",truckType: "CAN2",truckNo: "TN2323200",driverName: "Siva",noOfCase: "3",OPKM: "2",CLSKM: "5",diffKM: "4",advance: "500",perKMchargeCustomer: "6.5",perKMchargeVendor: "7.6",profit: "400",tollBill: "654787",policeBill: "57890",freightAmt: "700",haltingCharge: "700",remarks: "good"}];
							  
	*/	
	$scope.trip = {customername:"",vendorname:"",loadNo: "",tripNo: "",origin: "",destination: "",invoiceNO: "",dateTime: "",truckType: "",truckno: "",driverName: "",noOfCase: "",opkm: "0",clskm: "0",diffKM: "0",advance: "0",perkmchargecustomer: "0",perkmchargevendor: "0",gatein:"",gateout:"",haltedTime:"",customerhalt:"0",vendorhalt:"0",profit: "0",tollBill: "",policeBill: "",freightAmtCust: "0",freightAmtVen:"0",haltingCharge: "0",discount:"0",remarks: "",customerrate:0,vendorrate:0,customerperkm:0,vendorperkm:0};
	scope=$scope;
	$scope.vehm = {};
	$scope.vehm.dtVehicle = DTOptionsBuilder.newOptions()
    .withOption('order', [0, 'asc'])
    .withButtons([
      {
        extend: 'collection',
        text: 'Export',
        buttons: [{
            extend: 'copyHtml5',
            title: 'Mylist'
          },
          {
            extend: 'pdfHtml5',
            title: 'My list'
          },
		  {
            extend: 'excel',
            title: 'Excel'
          },
		  {
            extend: 'csv',
            title: 'My list'
          }
        ]
      }
    ]);
	
	$scope.validateOrigin =function(data){
		
		if(data && $scope.listdataJson.indexOf(data) == -1) {
			 toastr.error('Invalid Data');
			}
	}
	//existing code
	$scope.getCommonDetails =function(item){
		
		if(item){
		var url=localurl +"/api/v1/customervendorobjectfromtripsheet";
		 $http({
			    method : 'GET',
			    url : url,
			    params: {name: item}
			   }).then(function successCallback(response) {
			   console.log(response);
			   var respData=response.data[0];
			   if(respData.customername){
				   $scope.getTempCustVen =respData;
				   $scope.trip.truckno="";
			   }
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
		}
	}
	
	$scope.getFindcustomer =function(item){
			
			if(item){
			var url=localurl +"/api/v1/findcustomername?customercode="+item;
			 $http({
				    method : 'GET',
				    url : url
				    //params: {name: item}
				   }).then(function successCallback(response) {
				   console.log(response);
				   var respData=response.data;
				   if(respData.status){
					   $scope.trip.customername =respData.status;
					   $scope.trip.truckno="";
				   }
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				    $scope.trip.customername="";
				   });
			}else{
				$scope.trip.customername="";
			}
		}
	
	$scope.getFindvendorByTruckno =function(item){
		
		if(item){
		var url=localurl +"/api/v1/vendornamebytruckno";
		 $http({
			    method : 'GET',
			    url : url,
			    params: {truckno: item}
			   }).then(function successCallback(response) {
			   console.log(response);
			   var respData=response.data;
			   if(respData[0]){
				   $scope.trip.vendorname =respData[0];
				   // $scope.trip.customername =respData.status;
				  // $scope.trip.truckno="";
			   }
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			    $scope.trip.vendorname ="";
			   });
		}else{
			$scope.trip.vendorname ="";
		}
	}
	
	$scope.changeBasedNumber =function(item){
		if(item !="" && item !=undefined){
		 $scope.tempperkmchargecustomer="";
		$scope.tempperkmchargevendor="";
		$scope.tempfreightAmtCust="";
		$scope.tempfreightAmtVen="";
	 angular.forEach($scope.vehlistdataJson,function(value,index){
			 if(value.vehicleNo ==item){
				 $scope.trip.truckType=value.vehicleType;
			 }
	 })
				 $scope.tempperkmchargevendor=$scope.trip.vendorperkm ? $scope.trip.vendorperkm : 0 ;
				 $scope.tempfreightAmtVen=$scope.trip.vendorrate ? $scope.trip.vendorrate : 0 ;
				 $scope.trip.opkm=$scope.trip.opkm? $scope.trip.opkm : 0 ;
				 $scope.trip.clskm=$scope.trip.clskm ? $scope.trip.clskm : 0 ;
				 $scope.trip.diffKM=$scope.trip.diffKM ? $scope.trip.diffKM : 0 ;
				 $scope.trip.perkmchargevendor=$scope.trip.perkmchargevendor ? $scope.trip.perkmchargevendor : 0 ;
				 $scope.trip.perkmchargecustomer=$scope.trip.perkmchargecustomer? $scope.trip.perkmchargecustomer : 0 ;
				 $scope.trip.tollBill=$scope.trip.tollBill ? $scope.trip.tollBill : 0 ;
				 $scope.trip.policeBill=$scope.trip.policeBill ? $scope.trip.policeBill : 0 ;
				 
				 
				 //set customer perkm and fixed
				  var tempcustVen =$scope.getTempCustVen;
				// if($scope.getTempCustVen.customername && $scope.trip.destination){
					 if($scope.trip.origin && $scope.trip.destination){
					  $scope.tempfreightAmtCust=$scope.trip.customerrate ? $scope.trip.customerrate : 0 ;
					  $scope.tempperkmchargecustomer=$scope.trip.customerperkm ? $scope.trip.customerperkm : 0 ;
					 
					    if($scope.trip.truckType=="LCV2"){
						   $scope.checkDisabled =false;
						  // $scope.tempfreightAmtCust=tempcustVen.fixedamtlc2;
						  //$scope.tempperkmchargecustomer=tempcustVen.perkmlc2;
					   }else if($scope.trip.truckType=="LCV4"){
						   $scope.checkDisabled =false;
						   //$scope.tempperkmchargecustomer=tempcustVen.perkmlc4;
						   //$scope.tempfreightAmtCust=tempcustVen.fixedamtlc4;
					   }else if($scope.trip.truckType=="CAN6"){
						   $scope.checkDisabled =false;
						   //$scope.tempperkmchargecustomer=tempcustVen.perkmcan6;
						  // $scope.tempfreightAmtCust=tempcustVen.fixedamtcan6;
					   }else if($scope.trip.truckType=="HCV9"){
						   $scope.checkDisabled =true;
						  // $scope.tempperkmchargecustomer=tempcustVen.perkmhcv9;
						  // $scope.tempfreightAmtCust=tempcustVen.fixedamthcv9;
						  // $scope.tempfreightAmtCust= 0 ;
						  // $scope.tempperkmchargecustomer= 0 ;
					   }else if($scope.trip.truckType=="TARUS"){
						   $scope.checkDisabled =true;
						  // $scope.tempperkmchargecustomer=tempcustVen.perkmtrs;
						  // $scope.tempfreightAmtCust=tempcustVen.fixedamttrs;
						  
					   }else if($scope.trip.truckType=="TRALIER"){
						   $scope.checkDisabled =true;
						 //  $scope.tempperkmchargecustomer=tempcustVen.perkmtrailer;
						 //  $scope.tempfreightAmtCust=tempcustVen.fixedamttrailer;
						  
						 } 
						 if($scope.checkDisabled){
								 $scope.trip.customerperkm=0;
								 $scope.trip.vendorperkm=0;
								 $scope.trip.opkm=0;
								 $scope.trip.clskm=0;
								 $scope.trip.diffKM=0;
								 $scope.trip.perkmchargecustomer=0;
								 $scope.trip.perkmchargevendor=0;
						 }
				   }else{
					   toastr.error('Origin and Destination are mandatory to proceed further');
				   } 	 
			// }
			 
        // })
		
		}else{
			toastr.error('Please Choose Truck Type');
		}	
		$scope.addAmtoFrieght();
	}
	
	/* $scope.haltingCharge =function(){
		
		$scope.trip.freightAmtCust=eval($scope.trip.haltingCharge)+eval($scope.trip.freightAmtCust);
		
	} */
	$scope.calculateKm=function(opkm,clskm){
		if(opkm){
			if(eval(opkm)<eval(clskm)){
				$scope.trip.diffKM=(parseInt(clskm)? parseInt(clskm):0)-(parseInt(opkm)? parseInt(opkm):0);
				$scope.trip.perkmchargevendor=(parseInt($scope.trip.diffKM)? parseInt($scope.trip.diffKM):0) * (parseInt($scope.tempperkmchargevendor)? parseInt($scope.tempperkmchargevendor):0);
				$scope.trip.perkmchargecustomer=(parseInt($scope.trip.diffKM)? parseInt($scope.trip.diffKM):0) * (parseInt($scope.tempperkmchargecustomer)? parseInt($scope.tempperkmchargecustomer):0);
			}else{
				toastr.error('Close Kms should lesser than Open Kms');
				$scope.trip.diffKM="";
			}
		}else{
			toastr.error('Please Enter OpKms');
		}
		
	}
	 
	$scope.calculateDate=function(startDate,endDate){
			 startDate =new Date(startDate)
			endDate = new Date(endDate)
		if(startDate < endDate){ 	
		 var diff = endDate.getTime() - startDate.getTime();
	        var days = Math.floor(diff / (60 * 60 * 24 * 1000));
	        var hours = Math.floor(diff / (60 * 60 * 1000)) - (days * 24);
	        var minutes = Math.floor(diff / (60 * 1000)) - ((days * 24 * 60) + (hours * 60));
	        var seconds = Math.floor(diff / 1000) - ((days * 24 * 60 * 60) + (hours * 60 * 60) + (minutes * 60));
	        scope.trip.haltedTime = days +" Days "+ hours +" Hr " +minutes+" Min";
	        var dayminus =days;
	        dayminus =dayminus?dayminus:0;
	        if(scope.trip.truckType !="" && scope.trip.truckType =="EICHER"){
	        	scope.trip.customerhalt=(parseInt(dayminus)? parseInt(dayminus):0)*800;
	        	scope.trip.vendorhalt=(parseInt(dayminus)? parseInt(dayminus):0)*500;
	        }else if(scope.trip.truckType !="" && scope.trip.truckType =="HCV9"){
	        	scope.trip.customerhalt=(parseInt(dayminus)? parseInt(dayminus):0)*1000;
	        	scope.trip.vendorhalt=(parseInt(dayminus)? parseInt(dayminus):0)*900;
	        }else if(scope.trip.truckType !="" && scope.trip.truckType =="TARUS"){
	        	scope.trip.customerhalt=(parseInt(dayminus)? parseInt(dayminus):0)*1500;
	        	scope.trip.vendorhalt=(parseInt(dayminus)? parseInt(dayminus):0)*1200;
	        }
	        $scope.addAmtoFrieght();
	        //return { day: days, hour: hours, minute: minutes, second: seconds };
		 }else{
			//toastr.error('Please select the date and time correctly');
			scope.trip.gatein ="";
			scope.trip.gateout ="";
			angular.element('#gatedate').triggerHandler('click');
		} 
	}
	$scope.addAmtoFrieght =function(){
		
		/* if(typeof($scope.trip.freightAmtCust)=="undefined"){
			$scope.trip.freightAmtCust='0';
		}
		if(typeof($scope.trip.freightAmtVen)=="undefined" || typeof($scope.trip.freightAmtVen)=="number" ){
			$scope.trip.freightAmtVen='0';
		}
		if(typeof($scope.trip.policeBill)=="undefined"){
			$scope.trip.policeBill='0';
		}
		if(typeof($scope.trip.tollBill)=="undefined"){
			$scope.trip.tollBill='0';
		}
		if(typeof($scope.trip.haltingCharge)=="undefined"){
			$scope.trip.haltingCharge='0';
		} */
		$scope.trip.freightAmtCust=(parseInt($scope.trip.policeBill)? parseInt($scope.trip.policeBill):0)+(parseInt($scope.trip.tollBill)? parseInt($scope.trip.tollBill):0)+(parseInt($scope.tempfreightAmtCust)? parseInt($scope.tempfreightAmtCust):0)+(parseInt($scope.trip.customerhalt)? parseInt($scope.trip.customerhalt):0)+(parseInt($scope.trip.perkmchargecustomer)? parseInt($scope.trip.perkmchargecustomer):0);
		$scope.trip.freightAmtVen=(parseInt($scope.trip.policeBill)? parseInt($scope.trip.policeBill):0)+(parseInt($scope.trip.tollBill)? parseInt($scope.trip.tollBill):0)+(parseInt($scope.tempfreightAmtVen)? parseInt($scope.tempfreightAmtVen):0)+(parseInt($scope.trip.perkmchargevendor)? parseInt($scope.trip.perkmchargevendor):0)+(parseInt($scope.trip.vendorhalt)? parseInt($scope.trip.vendorhalt):0);
		$scope.trip.freightAmtVen =(parseInt($scope.trip.freightAmtVen)? parseInt($scope.trip.freightAmtVen):0) - (parseInt($scope.trip.advance)? parseInt($scope.trip.advance):0);
		$scope.trip.profit=(parseInt($scope.trip.freightAmtCust)? parseInt($scope.trip.freightAmtCust):0) - (parseInt($scope.trip.freightAmtVen)? parseInt($scope.trip.freightAmtVen):0);
	}
	
/* $scope.addAmtoFrieghtVen =function(data){
		
		if(typeof($scope.trip.freightAmtCust)=="undefined"){
			$scope.trip.freightAmtCust='0';
		}
		if(typeof($scope.trip.freightAmtVen)=="undefined" || typeof($scope.trip.freightAmtVen)=="number" ){
			$scope.trip.freightAmtVen='0';
		}
		if(typeof($scope.trip.tollBill)=="undefined"){
			$scope.trip.tollBill='0';
		}
		$scope.trip.freightAmtVen=eval($scope.trip.tollBill)+eval(data)+eval($scope.tempfreightAmtVen);
		//$scope.trip.freightAmtVen=eval($scope.trip.freightAmtVen)+eval(data);
	} */
$scope.createVehicle = function() {
$("#vehModal").modal('show');
$(".vehId").css("display","");
$(".addVeh").css("display","block");
$(".updateVeh").css("display","none");

}
$scope.createTrip = function() {
$scope.checkDisabled =false;
$('#tripModal').modal('show');
$(".addVeh").css("display","block");
$(".updateVeh").css("display","none");
//$scope.trip={};
$scope.trip = {customername:"",vendorname:"",loadNo: "",tripNo: "",origin: "",destination: "",invoiceNO: "",dateTime: "",truckType: "",truckno: "",driverName: "",noOfCase: "",opkm: "0",clskm: "0",diffKM: "0",advance: "0",perkmchargecustomer: "0",perkmchargevendor: "0",gatein:"",gateout:"",haltedTime:"",customerhalt:"0",vendorhalt:"0",profit: "0",tollBill: "",policeBill: "",freightAmtCust: "0",freightAmtVen:"0",haltingCharge: "0",discount:"0",remarks: "",customerrate:0,vendorrate:0,customerperkm:0,vendorperkm:0};
}
$scope.addTripItem = function(item) {
	  
	 if(!$scope.checkDisabled){
		 if(item.opkm==""){
			 toastr.error('Please enter opKm');
				return;
		}else if(item.clskm==""){
			 toastr.error('Please enter Clskm');
				return;
		}
	 }
	if(item.loadno==""){
		 toastr.error('Please enter Load Number');
		return;
	}else if(item.tripNo==""){
		 toastr.error('Please enter Trip Number');
		return;
	}
	else if(item.origin==""){
		 toastr.error('Please enter Origin');
		return;
	}else if(item.destination==""){
		 toastr.error('Please enter Destination');
			return;
	}else if(item.invoiceNo==""){
		 toastr.error('Please enter Invoice Number');
			return;
	}else if(item.datetime==""){
		 toastr.error('Please enter Date');
			return;
	}else if(item.truckno==""){
		 toastr.error('Please enter Truck Number');
			return;
	}else if(item.truckType==""){
		 toastr.error('Please enter Truck Type');
			return;
	}else if(item.driverName==""){
		 toastr.error('Please enter Driver Name');
			return;
	}else if(item.noOfCase==""){
		 toastr.error('Please enter No Of Case');
			return;
	}else if(item.advance==""){
		 toastr.error('Please enter Advance');
			return;
	}else if(item.tollBill==""){
		 toastr.error('Please enter Toll Bill');
			return;
	}else if(item.policeBill==""){
		 toastr.error('Please enter Police Bill');
			return;
	}else if(item.haltingCharge==""){
		 toastr.error('Please enter Halting Charge');
			return;
	}else if(item.discount==""){
		 toastr.error('Please enter Discount');
			return;
	}
	else{
//$scope.listVehicleJson.push(item);
var url = localurl +"/api/v1/createtripsheet";
	//$scope.listCustomerJson.push(angular.copy(item));
	    $http({
	        method : 'POST',
	        url : url,
	        data : angular.toJson(item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data added successfully');
	        	$scope.initVeh();
	        }, function error(response) {
	        	toastr.success('Data not added');
	          console.log(response.status);
	        });
	    $scope.trip = {customername:"",vendorname:"",loadNo: "",tripNo: "",origin: "",destination: "",invoiceNO: "",dateTime: "",truckType: "",truckno: "",driverName: "",noOfCase: "",opkm: "0",clskm: "0",diffKM: "0",advance: "0",perkmchargecustomer: "0",perkmchargevendor: "0",gatein:"",gateout:"",haltedTime:"",customerhalt:"0",vendorhalt:"0",profit: "0",tollBill: "",policeBill: "",freightAmtCust: "0",freightAmtVen:"0",haltingCharge: "0",discount:"0",remarks: "",customerrate:0,vendorrate:0,customerperkm:0,vendorperkm:0};
	}
}

$scope.closeUpload =function(){
	$("#uploadDiv").css("display","none");
};
$scope.openUpload =function(){
	$("#uploadDiv").css("display","block");
};
$scope.submitFileUpload =function(){
	 $scope.tripListPending=[];
	var uploadUrl = '/api/v1/upload';
    multipartForm.post(uploadUrl, $scope.file);
};
$scope.submitUpload =function(){
	console.log("submit");
	 var fd = new FormData()
     for (var i in $scope.files) {
         fd.append("uploadedFile", $scope.files[i]);
     }
     var xhr = new XMLHttpRequest()
     xhr.upload.addEventListener("progress", $scope.uploadProgress, false)
     xhr.addEventListener("load", $scope.uploadComplete, false)
     xhr.addEventListener("error", $scope.uploadFailed, false)
     xhr.addEventListener("abort", $scope.uploadCanceled, false)
     xhr.open("POST", "/fileupload")
     //scope.progressVisible = true
     xhr.send(fd)
};


$scope.uploadProgress =function(evt) {
    
}

$scope.uploadComplete = function(evt) {
    /* This event is raised when the server send back a response */
    alert(evt.target.responseText);
}

$scope.uploadFailed = function(evt) {
    alert("There was an error attempting to upload the file.");
}

$scope.uploadCanceled = function(evt) {
    alert("The upload has been canceled by the user or the browser dropped the connection.");
}

$scope.setFiles = function(element) {
    $scope.$apply(function(scope) {
      console.log('files:', element.files);
      // Turn the FileList object into an Array
        $scope.files = []
        for (var i = 0; i < element.files.length; i++) {
          $scope.files.push(element.files[i])
        }
    // scope.progressVisible = false
      });
    };

$scope.updateItem = function(item) {
/* for(i in $scope.listVehicleJson) {
               if($scope.listVehicleJson[i].codeId == $scope.item.codeId) {
                   $scope.listVehicleJson[i] = $scope.item;
               }
        } */
	var url = localurl +"/api/v1/updatetripsheet";
	//$scope.listCustomerJson.push(angular.copy(item));
	console.log($scope.item);
	    $http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.trip),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data updated successfully');
	        	$scope.initVeh();
	        }, function error(response) {
	        	toastr.success('Data not updated');
	          console.log(response.status);
	        });
	    //$scope.trip = {loadNo: "",tripNo: "",origin: "",destination: "",invoiceNO: "",dateTime: "",truckType: "",truckno: "",driverName: "",noOfCase: "",opkm: "0",clskm: "0",diffKM: "0",advance: "0",perkmchargecustomer: "0",perkmchargevendor: "0",gatein:"",gateout:"",haltedTime:"",customerhalt:"0",vendorhalt:"0",profit: "0",tollBill: "",policeBill: "",freightAmtCust: "0",freightAmtVen:"0",haltingCharge: "0",discount:"0",remarks: ""};
}
$scope.removeItem = function(item){
//$scope.listVehicleJson.splice(index,1);
	var url=localurl +"/api/v1/tripsheet/"+item.tripid;
	 $http({
		    method : 'DELETE',
		    url : url,
		   }).then(function successCallback(response) {
			   toastr.success('Data deleted successfully');
			   $scope.initVeh();
		   }, function errorCallback(response) {
			   toastr.success('Data not deleted');
		    console.log(response.statusText);
		   });
}
$scope.editVehicle = function(index){
	$('#tripModal').modal('show');
  //$("#vehModal").modal('show');
  $(".vehId").css("display","none");
  $(".addVeh").css("display","none");
  $(".updateVeh").css("display","block");
for(i in $scope.listVehicleJson) {
       if($scope.listVehicleJson[i].truckno == index.truckno) {
           $scope.trip = angular.copy($scope.listVehicleJson[i]);
       }
   }
}
$scope.newtabTrip =function(){
	 var w = $window.open();
	  var html = $(".tripItems").html();
	  $(w.document.head).append("<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'>");
	  var scriptjquery = document.createElement( 'script' );
	  scriptjquery.type = 'text/javascript';
	  scriptjquery.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js';
	  $(w.document.head).append( scriptjquery );
	  var scriptbootstrap = document.createElement( 'script' );
	  scriptbootstrap.type = 'text/javascript';
	  scriptbootstrap.src = 'https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js';
	  $(w.document.head).append( scriptbootstrap );
	  $(w.document.body).html(html);
	setTimeout(function(){ 
	    w.print();
	}, 500);
}
$scope.initVeh =function(){
	 $('#datetimepicker5').datetimepicker(/* {
	        format: 'DD/MM/YYYY'
	    } */);
	
	 /* $("#startdate").datetimepicker({
	        todayBtn:  1,
	        autoclose: true,
	    }).on('changeDate', function (selected) {
	        var minDate = new Date(selected.date.valueOf());
	        $('#enddate').datepicker('setStartDate', minDate);
	    }); */
	 /* $('#datetimepicker_gateIn').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
	 $('#datetimepicker_gateOut').datetimepicker({
		        format: 'DD/MM/YYYY'
		    }); */
	 var url=localurl +"/api/v1/triplist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listVehicleJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
}
$scope.getCustVenList =function(){
	 var url=localurl +"/api/v1/customercodelist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
			 //$scope.listCustJson = response.data;
			 $scope.listdataJson=response.data;  
		   /* angular.forEach(response.data,function(value,index){
			   if(value.customername || value.vendorname){
				   $scope.listdataJson.push(value.customername ? value.customername : value.vendorname);  
			   }
			   
		   }); */
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
}
$scope.getTruckList =function(){
	 var url=localurl +"/api/v1/vehiclelist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   //$scope.listCustJson = response.data;
		    $scope.vehlistdataJson = []; 
           /*  var values = [ 
            {name: 'Binary Search'}, 
            {name: 'Linear Search'}, 
            {name: 'Interpolation Search'} 
            ];   
            angular.forEach(values, function (value, key) { 
                $scope.names.push(value.name); 
            }); */ 
		   $scope.vehlistdataJson=response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
}
$scope.getTruckNo = function(selectedType) {

    // get the selected bank object from the banks array
    var filteredBank = $filter('filter')($scope.vehlistdataJson, selectedType);
    $scope.getTruckType.push(filteredBank[0].vehicleNo);
    // return the branches of the selected bank
    //return filteredBank[0].vehicleNo;
    
};
 
$scope.initVeh();
$scope.getCustVenList();
$scope.getTruckList();
	
$scope.bay=function() {
	var xmlhttp;
	if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
		xmlhttp = new XMLHttpRequest();
		var myWindow = $window.open('', '', 'width=2000,height=1000');
		  $(myWindow.document.head).append("<link rel='stylesheet' href='https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css'>");
		  var scriptjquery = document.createElement( 'script' );
		  scriptjquery.type = 'text/javascript';
		  scriptjquery.src = 'https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js';
		  $(myWindow.document.head).append( scriptjquery );
		  var scriptbootstrap = document.createElement( 'script' );
		  scriptbootstrap.type = 'text/javascript';
		  scriptbootstrap.src = 'https://maxcdn.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js';
		  $(myWindow.document.head).append( scriptbootstrap );
		  
		myWindow.document.write("<body style='font: bold; font-size: xxx-small; line-height: 0.5cm;'><img src=\"img/sse.png height='42px' width='42px'\"><h1 align='center'>SSE LOGISTICS PRIVATE LIMITED</h1> ");
						//+ "<h4  align='center'>484, Pantheon Plaza, Pantheon Road, Egmore, Chennai - 600 008. INDIA</h4>"
						//+ "<h4  align='center'>Ph:+91-44-1111 4444, 2222 3333  FAX:+91-44-5559-5555</h4>");
		
		//$(myWindow.document.body).append("<div class='container'><div class='row'><div class='col-xs-5'><div class='panel panel-default'><div class='panel-heading'><h3 class='panel-title'>Company Details</h3></div><div class='panel-body'><dl class='dl-horizontal'><dt>Name</dt><dd><strong>Acme Corporation</strong></dd><dt>Industry</dt><dd>Software Development</dd><dt>Address</dt><dd>Field 3, Moon</dd><dt>Phone</dt><dd>123.4456.4567</dd><dt>Email</dt><dd>mainl@acme.com</dd><dt>Tax NO</dt><dd class='mono'>123456789</dd><dt>Tax Office</dt><dd>A' Moon</dd></div></div></div><div class='col-xs-7'><div class='panel panel-default'><div class='panel-heading'><h3 class='panel-title'>Customer Details</h3></div><div class='panel-body'><dl class='dl-horizontal'><dt>Name</dt><dd>Microsoft Corporation</dd><dt>Industry</dt><dd>Software Development</dd><dt>Address</dt><dd>One Microsoft Way Redmond, WA 98052-7329, USA</dd><dt>Phone</dt><dd>(425) 882-8080</dd><dt>Email</dt><dd>contact@microsoft.com</dd><dt>Tax NO</dt><dd class='mono'>123456789</dd><dt>&nbsp;</dt><dd>&nbsp;</dd></div></div></div></div></div>");
		$(myWindow.document.body).append("<table border='1'; cellpadding=0.1; cellspacing=5; align='center' >"
						+ "<tr><td><b>FROM</b></td><td><b>TO</b></td>"
						+ "<td>DATE</td><td>VEHICLETYPE</td><td>VEHICLENO </td><td>DRIVERNAME</td>" + "</tr><tr><td><b> " +  $scope.trip.from
						+ "   </b></td><td><b>" + $scope.trip.to + "</b></td>" + "<td>" + $scope.trip.date
						+ "</td><td>" + $scope.trip.vehicleType + "</td><td>" + $scope.trip.vehicleNo + " </td><td>"+$scope.trip.driverName+"</td>"
						+ "</tr></table>");
		$(myWindow.document.body).append("");
		
		$(myWindow.document).close();
		$(myWindow).focus();
		$(myWindow).print();
		$(myWindow).close();
	} else {// code for IE6, IE5
		xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
	}
	xmlhttp.onreadystatechange = function() {
		if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
			document.getElementById("myDiv").innerHTML = xmlhttp.responseText;
		}
	}
	
	xmlhttp.send();
}
});
app.controller('UserController', function ($scope,$http,$location,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder,toastr) {
	$scope.listUserJson=[];
	/* $scope.listUserJson =[{codeId: "1111",userId: "1111",userName: "Demo", email: "Supervisor@gamil.com", password: "GradeA", retypepassword: "GradeA", userRole: "Supervisor"},
						  {codeId: "2222",userId: "2222",userName: "XYZ", email: "Employee@gmail.com", password: "GradeB", retypepassword: "GradeA", userRole: "Employee"},
						  {codeId: "3333",userId: "3333",userName: "ABC", email: "Manager@gmail.com", password: "GradeC", retypepassword: "GradeA", userRole: "Manager"},
						  {codeId: "4444",userId: "4444",userName: "QWERT", email: "SalesExecutive@gmail.com", password: "GradeD", retypepassword: "GradeA", userRole: "SalesExecutive"}]; */				
	$scope.um = {};
	$scope.um.dtUser = DTOptionsBuilder.newOptions()
    .withOption('order', [0, 'asc'])
    .withButtons([
      {
        extend: 'collection',
        text: 'Export',
        buttons: [{
            extend: 'copyHtml5',
            title: 'Mylist'
          },
          {
            extend: 'pdfHtml5',
            title: 'My list'
          },
		  {
            extend: 'excel',
            title: 'Excel'
          },
		  {
            extend: 'csv',
            title: 'My list'
          }
        ]
      }
    ]);
$scope.createUser = function() {
$("#usrModal").modal('show');
$(".usrId").css("display","");
$(".addUsr").css("display","block");
$(".updateUsr").css("display","none");
$scope.item = {};
}
$scope.addItem = function(item) {
//$scope.listUserJson.push(item);
var url = localurl +"/api/v1/createuser";
	//$scope.listCustomerJson.push(angular.copy(item));
	    $http({
	        method : 'POST',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data added successfully');
	        	$scope.initUser();
	        }, function error(response) {
	        	toastr.success('Data not added');
	          console.log(response.status);
	        });
$scope.item = {};

}
$scope.updateItem = function(item) {
/* for(i in $scope.listUserJson) {
            if($scope.listUserJson[i].codeId == $scope.item.codeId) {
                $scope.listUserJson[i] = $scope.item;
            }
     } */
	var url = localurl +"/api/v1/userupdate";
	//$scope.listCustomerJson.push(angular.copy(item));
	console.log($scope.item);
	    $http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.item),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Data updated successfully');
	        	$scope.initUser();
	        }, function error(response) {
	        	toastr.success('Data not updated');
	          console.log(response.status);
	        });
}
$scope.removeItem = function(item){
//$scope.listUserJson.splice(index,1);
	var url=localurl +"/api/v1/user/"+item.id;
	 $http({
		    method : 'DELETE',
		    url : url,
		   }).then(function successCallback(response) {
			   toastr.success('Data deleted successfully');
			   $scope.initUser();
		   }, function errorCallback(response) {
			   toastr.success('Data not deleted');
		    console.log(response.statusText);
		   });
}
$scope.editCustomer = function(index){

$("#usrModal").modal('show');
$(".usrId").css("display","none");
$(".addUsr").css("display","none");
$(".updateUsr").css("display","block");
for(i in $scope.listUserJson) {
    if($scope.listUserJson[i].codeId == index.codeId) {
        $scope.item = angular.copy($scope.listUserJson[i]);
    }
}
}
$scope.initUser =function(){
	
	 var url=localurl +"/api/v1/userlist";
	 $http({
		    method : 'GET',
		    url : url,
		   }).then(function successCallback(response) {
		   $scope.listUserJson = response.data;
		   }, function errorCallback(response) {
		    console.log(response.statusText);
		   });
}
$scope.initUser();
});

app.controller('UserAccessController', function ($scope,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder) {
	
	$scope.listUserAccessJson =[{permissionScreen: "Customer",addPerm: true, editPerm: true, delPerm: true, viewPerm: true, reportPerm: true},
								  {permissionScreen: "vendor",addPerm: true, editPerm: true, delPerm: true, viewPerm: true, reportPerm: true},
								  {permissionScreen: "Billing",addPerm: true, editPerm: true, delPerm: true, viewPerm: true, reportPerm: true},
								  {permissionScreen: "Product",addPerm: true, editPerm: true, delPerm: true, viewPerm: true, reportPerm: true}];				
});
app.controller('BillingController',function ($compile,$scope, $window,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder,$http,$resource,$location, $q,$timeout,toastr,multipartForm) {
	$scope.file = {};
	$scope.customerInvoice={fromdate:"",todate:""};
	$scope.vendorInvoice={fromdate:"",todate:"",truckno:""};
	$scope.customerView={fromdate:"",todate:""};
	$scope.vendorView={fromdate:"",todate:"",vendorname:""};
	$scope.checkedValue=[];
	$scope.checkedVendorValue=[];
	$scope.listBillingJson =[{customerName: "SAI Sakthi",shipperName: "xyzz", consignorName: "ABCCC", billingDetails: {}},
							  {customerName: "Samsang",shipperName: "ABCCC", consignorName: "ABCCC", billingDetails: {}},
							  {customerName: "titan",shipperName: "ABCCC", consignorName: "ABCCC",billingDetails: {}},
							  {customerName: "sonaata",shipperName: "ABCCC", consignorName: "ABCCC", billingDetails: {}}];	
	 /* $scope.customerInvoiceJson =[{id:"1",loadNo: "23678",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "2000",advance:"",discount:"1000",grandTotal:""},
								{id:"2",loadNo: "2008",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "1000",advance:"500",discount:"",grandTotal:""},
								{id:"3",loadNo: "2998",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "500",advance:"",discount:"200",grandTotal:""},
								{id:"4",loadNo: "23678",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "2000",advance:"100",discount:"",grandTotal:""},
								{id:"5",loadNo: "20002",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "400",advance:"",discount:"400",grandTotal:""},
								{id:"6",loadNo: "23",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "3000",advance:"400",discount:"",grandTotal:""}]; */	
	$scope.customerInvoiceJson =[];
	$scope.vendorInvoiceJson =[];
	$scope.customerViewList=[];
	$scope.vendorViewList =[];
	$scope.vendorNameList =[];
	$scope.criteriaCust = {};
	$scope.criteriaView = {};
	/* $scope.vendorInvoiceJson =[{id:"1",loadNo: "23678",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "2000",advance:"",discount:"1000",grandTotal:""},
		{id:"2",loadNo: "2008",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "1000",advance:"500",discount:"",grandTotal:""},
		{id:"3",loadNo: "2998",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "500",advance:"",discount:"200",grandTotal:""},
		{id:"4",loadNo: "23678",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "2000",advance:"100",discount:"",grandTotal:""},
		{id:"5",loadNo: "20002",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "400",advance:"",discount:"400",grandTotal:""},
		{id:"6",loadNo: "23",datetime: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckno: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opkm:"678",clskm:"788",diffKM: "100", perkmchargecustomer: "330", freightAmtCust: "3000",advance:"400",discount:"",grandTotal:""}]; */
	$scope.checked=false;
/* 	$scope.toggleAll = function(selectAll, selectedItems) {
        for (var id in selectedItems) {
            if (selectedItems.hasOwnProperty(id)) {
                selectedItems[id] = selectAll;
            }
        }
    };
 $scope.toggleOne= function(selectedItems) {
        for (var id in selectedItems) {
            if (selectedItems.hasOwnProperty(id)) {
                if(!selectedItems[id]) {
                	$scope.selectAll = false;
                    return;
                }
            }
        }
        $scope.selectAll = true;
    };
	//vendor datatable
	 //var bm = $scope;
	 $scope.selected = {};
	 $scope.selectAll = false;
	 $scope.toggleAll = $scope.toggleAll;
	 $scope.toggleOne = $scope.toggleOne;
	 $scope.dtInstance = {};
	 
	 $scope.getTableData = function() {
		    var deferred = $q.defer();
		    deferred.resolve($scope.customerInvoiceJson); 
		    return deferred.promise;
		};
	
	 var titleHtml = '<input type="checkbox" ng-model="bm.selectAll" ng-click="bm.toggleAll(bm.selectAll,bm.selected)">';

		//$scope.bm.dtOptions = DTOptionsBuilder.newOptions()fromFnPromise
		$scope.dtOptions = DTOptionsBuilder.fromSource($scope.getTableData) 
         .withPaginationType('full_numbers')
         .withOption('createdRow', function(row, data, dataIndex) {
            // Recompiling so we can bind Angular directive to the DT
            $compile(angular.element(row).contents())($scope);
        })
        	.withOption('headerCallback', function(header) {
            if (!$scope.headerCompiled) {
                // Use this headerCompiled field to only compile header once
                $scope.headerCompiled = true;
                $compile(angular.element(header).contents())($scope);
            }
        })
		        .withOption('scrollY', '300px')
		        .withOption('scrollX', '100%')
		        .withOption('scrollCollapse', true)
		        .withFixedColumns({
		            leftColumns: 1,
		            rightColumns: 1
		        });
	
		$scope.dtColumns = [
	        DTColumnBuilder.newColumn(null).withTitle(titleHtml)
	            .renderWith(function(data, type, full, meta) {
	            	$scope.selected[full.id] = false;
	                return '<input type="checkbox" ng-model="$scope.selected[' + data.id + ']" ng-click="$scope.toggleOne($scope.selected)">';
	            }), 
	           
	        	DTColumnBuilder.newColumn('LRNO').withTitle('LRNO'),
	            DTColumnBuilder.newColumn('date').withTitle('date'),
	            DTColumnBuilder.newColumn('invoiceNo').withTitle('invoiceNo'),
	            DTColumnBuilder.newColumn('origin').withTitle('origin'),
	            DTColumnBuilder.newColumn('customerName').withTitle('customerName'),
	            DTColumnBuilder.newColumn('destination').withTitle('destination'),
	            DTColumnBuilder.newColumn('truckNo').withTitle('truckNo'),
	            DTColumnBuilder.newColumn('truckType').withTitle('truckType'),
	            DTColumnBuilder.newColumn('noOfCase').withTitle('noOfcase'),
	            DTColumnBuilder.newColumn('opKms').withTitle('opkms'),
	            DTColumnBuilder.newColumn('clsKms').withTitle('clskms'),
	            DTColumnBuilder.newColumn('totalkms').withTitle('totalkms'),
	            DTColumnBuilder.newColumn('forKms').withTitle('forkms'),
	            DTColumnBuilder.newColumn('tRTypeFixed').withTitle('tRTypeFixed'),
	            DTColumnBuilder.newColumn('advance').withTitle('advance'),
	            DTColumnBuilder.newColumn('grandTotal').withTitle('grandTotal')
	           // DTColumnBuilder.newColumn(null).withTitle('Action')
	    ]; 
     */
		 
    /*  $scope.settings = {
		      selectAll: false
		    } */
		    
		    
	
	$scope.saveInArray =function(index){
    	 if($scope.customerInvoiceJson[index].checked) {
    	      $scope.checkedValue.push($scope.customerInvoiceJson[index]);
    	    } else {
    	       var newIndex = $scope.checkedValue.map(function(e) { return e.loadno; }).indexOf($scope.customerInvoiceJson[index].loadno);
    	       // for compare instead of "loadNo" you should use that field is unique. ie: e.uniqueField
    	       // and $scope.customerInvoiceJson[index].uniqueField
    	       if(newIndex !== -1)
    	          $scope.checkedValue.splice(newIndex,1);
    	    }
     }
	$scope.saveVendorInArray =function(index){
   	 if($scope.vendorInvoiceJson[index].checked) {
   	      $scope.checkedVendorValue.push($scope.vendorInvoiceJson[index]);
   	    } else {
   	       var newIndex = $scope.checkedVendorValue.map(function(e) { return e.loadno; }).indexOf($scope.vendorInvoiceJson[index].loadno);
   	       // for compare instead of "loadNo" you should use that field is unique. ie: e.uniqueField
   	       // and $scope.customerInvoiceJson[index].uniqueField
   	       if(newIndex !== -1)
   	          $scope.checkedVendorValue.splice(newIndex,1);
   	    }
    }
	$scope.init_Billing =function(){
		 /* $('#datetimepicker_billDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    }); 
		    $('#datetimepicker_billvenDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });*/
		    $('#datetimepicker_startBillDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		    $('#datetimepicker_endBillDate').datetimepicker({
		        format: 'DD/MM/YYYY'
			});
			$('#datetimepicker_fromdate').datetimepicker({
		        format: 'MM/DD/YYYY'
			});
			$('#datetimepicker_todate').datetimepicker({
		        format: 'MM/DD/YYYY'
			});
			$('#datetimepicker_fromvendordate').datetimepicker({
		        format: 'MM/DD/YYYY'
			});
			$('#datetimepicker_tovendordate').datetimepicker({
		        format: 'MM/DD/YYYY'
			});
			$('#datetimepicker_fromcustview').datetimepicker({
		        format: 'DD/MM/YYYY'
			});
			$('#datetimepicker_tocustview').datetimepicker({
		        format: 'DD/MM/YYYY'
			});
			
			$('#datetimepicker_custinvoicedate').datetimepicker({
		        format: 'DD/MM/YYYY'
			});
			
			$('#datetimepicker_veninvoicedate').datetimepicker({
		        format: 'DD/MM/YYYY'
			});
			$('#datetimepicker_mpinvoicedate').datetimepicker({
		        format: 'DD/MM/YYYY'
			});
			var bm = $scope;
			bm.dtInstanceCallback = function(instance) {
			 	bm.dtInstance = instance;
	    };
	    
	    bm.dtOptions = DTOptionsBuilder.newOptions()
			        .withOption('scrollY', '300px')
			        .withOption('scrollX', '100%')
			        .withOption('scrollCollapse', true)
			        .withFixedColumns({
			            leftColumns: 1,
			            rightColumns: 1
			        });
	    
	}
	/* $scope.addKmsandFixed =function(kms,fix){

angular.forEach($scope.customerInvoiceJson, function(value, key) {
  //this.push(key + ': ' + value);
  value.forKms=kms;
  value.tRTypeFixed=fix;
  value.grandTotal=(value.totalkms * value.forKms)+value.tRTypeFixed -value.advance;
});
	}; */
	

	$scope.searchcustItem =function(){
		if($scope.customerInvoice.fromdate==""){
			 toastr.error('Please enter From date');
			return;
		}else if($scope.customerInvoice.todate==""){
			 toastr.error('Please enter To date');
			return;
		}else{
			var url=localurl +"/api/v1/customerinvoicelist";
			 $http({
				    method : 'GET',
				    url : url,
				    params: $scope.customerInvoice,
				   }).then(function successCallback(response) {
				   $scope.customerInvoiceJson = response.data;
				   $scope.checkedValue=[];
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		}
		
	};
	
	$scope.searchvenItem =function(){
		if($scope.vendorInvoice.fromdate==""){
			 toastr.error('Please enter From date');
			return;
		}else if($scope.vendorInvoice.todate==""){
			 toastr.error('Please enter To date');
			return;
		}else if($scope.vendorInvoice.truckno==""){
			 toastr.error('Please enter Truck No');
			return;
		}else{
			var url=localurl +"/api/v1/vendorinvoicelistintripsheet";
			 $http({
				    method : 'GET',
				    url : url,
				    params: $scope.vendorInvoice,
				   }).then(function successCallback(response) {
				   $scope.vendorInvoiceJson = response.data;
				   $scope.checkedVendorValue=[];
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		}
		
	};
	
	$scope.searchcustView =function(){
		if($scope.customerView.fromdate=="" || $scope.customerView.fromdate== undefined){
			 toastr.error('Please enter From date');
			return;
		}else if($scope.customerView.todate=="" || $scope.customerView.todate==undefined){
			 toastr.error('Please enter To date');
			return;
		}/*else if($scope.customerView.customername=="" || $scope.customerView.customername== undefined){
			 toastr.error('Please enter CustomerName');
			return;
		}*/else{
			var url=localurl +"/api/v1/invoicelistincustomer";
			 $http({
				    method : 'GET',
				    url : url,
				    params: $scope.customerView,
				   }).then(function successCallback(response) {
				   $scope.customerViewList = response.data;
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		}
		
	};
	
	$scope.searchvenView =function(){
		if($scope.vendorView.fromdate=="" || $scope.vendorView.fromdate== undefined){
			 toastr.error('Please enter From date');
			return;
		}else if($scope.vendorView.todate=="" || $scope.vendorView.todate== undefined){
			 toastr.error('Please enter To date');
			return;
		}else if($scope.vendorView.vendorname=="" || $scope.vendorView.vendorname== undefined){
			 toastr.error('Please enter VendorName');
			return;
		}else{
			var url=localurl +"/api/v1/vendorinvoicelistinvendor";
			 $http({
				    method : 'GET',
				    url : url,
				    params: $scope.vendorView,
				   }).then(function successCallback(response) {
				   $scope.vendorViewList = response.data;
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		}
		
	};
	
	$scope.resetcustItem=function() {
		$scope.customerInvoice={fromdate:"",todate:""};
		$scope.customerInvoiceJson=[];
	}

	$scope.resetvenItem=function() {
		$scope.vendorInvoice={fromdate:"",todate:"",truckno:""};
		$scope.vendorInvoiceJson=[];
	}
	$scope.resetvenView=function() {
		$scope.vendorView={fromdate:"",todate:"",vendorname:""};
		//$scope.initvenView();
		$scope.vendorViewList=[];
	}
	
	$scope.resetcustView=function() {
		//$scope.initView();
		$scope.customerView={fromdate:"",todate:""};
		$scope.customerViewList=[];
	}
	
	$scope.custInvoicePrint=function() {
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
			var myWindow = $window.open('', '', 'width=2000,height=1000');
			myWindow.document.write('<html><head><title>Invoice</title><link rel="stylesheet" type="text/css" href="css/pdfstyle.css"></head><body>');
			$(myWindow.document.body).append($("table[id=custpdfInvoice]").clone(true));
			myWindow.document.write('</body></html>');
			setTimeout(function(){ 
			$(myWindow)[0].focus();
			$(myWindow)[0].print();
			$(myWindow)[0].close();
			scope.resetCustomerInvoice();
			 }, 1000);
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				document.getElementById("myDiv").innerHTML = xmlhttp.responseText;
			}
		}
		
		xmlhttp.send();
	}
	
	$scope.venInvoicePrint=function() {
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
			var myWindows = $window.open('', '', 'width=2000,height=1000');
			myWindows.document.write('<html><head><title>Invoice</title><link rel="stylesheet" type="text/css" href="css/pdfstyle.css"></head><body>');
			$(myWindows.document.body).append($("table[id=venpdfInvoice]").clone(true));
			myWindows.document.write('</body></html>');
			setTimeout(function(){ 
			$(myWindows)[0].focus();
			$(myWindows)[0].print();
			$(myWindows)[0].close();
			 }, 1000);
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				document.getElementById("myvenDiv").innerHTML = xmlhttp.responseText;
			}
		}
		
		xmlhttp.send();
	}
	
	$scope.custViewPrint=function() {
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
			var custViewWindows = $window.open('', '', 'width=2000,height=1000');
			custViewWindows.document.write('<html><head><title>Invoice</title><link rel="stylesheet" type="text/css" href="css/pdfstyle.css"></head><body>');
			$(custViewWindows.document.body).append($("table[id=custViewInvoice]").clone(true));
			custViewWindows.document.write('</body></html>');
			setTimeout(function(){ 
			$(custViewWindows)[0].focus();
			$(custViewWindows)[0].print();
			$(custViewWindows)[0].close();
			 }, 1000);
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				document.getElementById("mycustviewDiv").innerHTML = xmlhttp.responseText;
			}
		}
		
		xmlhttp.send();
	}
	
	$scope.venViewPrint=function() {
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
			var venViewWindows = $window.open('', '', 'width=2000,height=1000');
			venViewWindows.document.write('<html><head><title>Invoice</title><link rel="stylesheet" type="text/css" href="css/pdfstyle.css"></head><body>');
			$(venViewWindows.document.body).append($("table[id=venViewInvoice]").clone(true));
			venViewWindows.document.write('</body></html>');
			setTimeout(function(){ 
			$(venViewWindows)[0].focus();
			$(venViewWindows)[0].print();
			$(venViewWindows)[0].close();
			 }, 1000);
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				document.getElementById("myvenviewDiv").innerHTML = xmlhttp.responseText;
			}
		}
		
		xmlhttp.send();
	}
	/* $scope.redirectToTab = function(){
        $window.open('billing.html', '', 'width=2000,height=1000');
    }; */
	$scope.addKmsandFixedVendor =function(kms,fix){
		angular.forEach($scope.vendorInvoiceJson, function(value, key) {
		  value.forKms=kms;
		  value.tRTypeFixed=fix;
		  value.grandTotal=(value.totalkms * value.forKms)+value.tRTypeFixed -value.advance;
		});
	};
	$scope.closeUpload =function(){
		$("#uploadDiv").css("display","none");
	};
	
	$scope.openUpload =function(){
		$("#uploadDiv").css("display","block");
	};
	$scope.removeInvoice  =function(index){
		$scope.customerInvoiceJson.splice(index,1);
		//$scope.bm.dtInstance.rerender();
	};
	
	$scope.calculateTotal =function(){
		$scope.grandTotalList={totaltrip:"",customername:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
		angular.forEach($scope.checkedValue, function(value, key) {
			$scope.grandTotalList.customername = value.customername;
			$scope.grandTotalList.truckno = value.truckno;
			$scope.grandTotalList.trucktype = value.truckType;
			$scope.grandTotalList.totalkm += parseInt(value.diffKM)? parseInt(value.diffKM):0;
			$scope.grandTotalList.totalcase +=parseInt(value.noOfCase)?parseInt(value.noOfCase):0;;
			$scope.grandTotalList.totalkmpercharge +=parseInt(value.perkmchargecustomer)?parseInt(value.perkmchargecustomer):0;;
			$scope.grandTotalList.totalfreightamt +=parseInt(value.freightAmtCust)?parseInt(value.freightAmtCust):0;
			$scope.grandTotalList.totaladvance +=parseInt(value.advance)?parseInt(value.advance):0;
			$scope.grandTotalList.totaldiscount +=parseInt(value.discount)? parseInt(value.discount):0;
		});
		$scope.grandTotalList.totaltrip=$scope.checkedValue.length;
		$scope.grandTotalList.netTempamount =(parseInt($scope.grandTotalList.totalkmpercharge) ?parseInt($scope.grandTotalList.totalkmpercharge) :0) + (parseInt($scope.grandTotalList.totalfreightamt)?parseInt($scope.grandTotalList.totalfreightamt):0);
		var adCount =(parseInt($scope.grandTotalList.totaldiscount) ? parseInt($scope.grandTotalList.totaldiscount): 0) +(parseInt($scope.grandTotalList.totaladvance) ? parseInt($scope.grandTotalList.totaladvance): 0);
		$scope.grandTotalList.netamount =(parseInt($scope.grandTotalList.netTempamount) ? parseInt($scope.grandTotalList.netTempamount): 0) - (parseInt(adCount) ? parseInt(adCount):0);
		console.log($scope.grandTotalList);
	};
	
	$scope.addLeakTotal =function(leak){
		$scope.grandTotalList.leakage=parseInt(leak) ? parseInt(leak): 0;
		$scope.grandTotalList.netTempamount =(parseInt($scope.grandTotalList.totalkmpercharge) ?parseInt($scope.grandTotalList.totalkmpercharge) :0) + (parseInt($scope.grandTotalList.totalfreightamt)?parseInt($scope.grandTotalList.totalfreightamt):0);
		var adCount =(parseInt($scope.grandTotalList.totaldiscount) ? parseInt($scope.grandTotalList.totaldiscount): 0) +(parseInt($scope.grandTotalList.totaladvance) ? parseInt($scope.grandTotalList.totaladvance): 0);
		var leakamt = (parseInt(adCount) ? parseInt(adCount):0) +(parseInt($scope.grandTotalList.leakage) ? parseInt($scope.grandTotalList.leakage):0)
		$scope.grandTotalList.netamount =(parseInt($scope.grandTotalList.netTempamount) ? parseInt($scope.grandTotalList.netTempamount): 0) - (parseInt(leakamt) ? parseInt(leakamt):0);
		
		//$scope.grandTotalList.netamount =(parseInt($scope.grandTotalList.netTempamount) ? parseInt($scope.grandTotalList.netTempamount): 0) - (parseInt(leak) ? parseInt(leak): 0);
	}
	
	$scope.calculateVendorTotal =function(){
		$scope.grandTotalVendorList={totaltrip:"",vendorname:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
		angular.forEach($scope.checkedVendorValue, function(value, key) {
			$scope.grandTotalVendorList.vendorname = value.vendorname;
			$scope.grandTotalVendorList.truckno = value.truckno;
			$scope.grandTotalVendorList.trucktype = value.truckType;
			
			$scope.grandTotalVendorList.totalkm += parseInt(value.diffKM)? parseInt(value.diffKM):0;
			$scope.grandTotalVendorList.totalcase +=parseInt(value.noOfCase)?parseInt(value.noOfCase):0;;
			$scope.grandTotalVendorList.totalkmpercharge +=parseInt(value.perkmchargecustomer)?parseInt(value.perkmchargecustomer):0;;
			$scope.grandTotalVendorList.totalfreightamt +=parseInt(value.freightAmtCust)?parseInt(value.freightAmtCust):0;
			$scope.grandTotalVendorList.totaladvance +=parseInt(value.advance)?parseInt(value.advance):0;
			$scope.grandTotalVendorList.totaldiscount +=parseInt(value.discount)? parseInt(value.discount):0;
		});
		$scope.grandTotalVendorList.totaltrip=$scope.checkedVendorValue.length;
		$scope.grandTotalVendorList.netTempamount =(parseInt($scope.grandTotalVendorList.totalkmpercharge) ?parseInt($scope.grandTotalVendorList.totalkmpercharge) :0) + (parseInt($scope.grandTotalVendorList.totalfreightamt)?parseInt($scope.grandTotalVendorList.totalfreightamt):0);
		var adVenCount =(parseInt($scope.grandTotalVendorList.totaldiscount) ? parseInt($scope.grandTotalVendorList.totaldiscount): 0) +(parseInt($scope.grandTotalVendorList.totaladvance) ? parseInt($scope.grandTotalVendorList.totaladvance): 0);
		$scope.grandTotalVendorList.netamount =(parseInt($scope.grandTotalVendorList.netTempamount) ? parseInt($scope.grandTotalVendorList.netTempamount): 0) - (parseInt(adVenCount) ? parseInt(adVenCount):0);
		console.log($scope.grandTotalVendorList);
	} 
	
	$scope.addVendorLeakTotal =function(leak){
		$scope.grandTotalVendorList.leakage=parseInt(leak) ? parseInt(leak): 0;
		$scope.grandTotalVendorList.netamount =(parseInt($scope.grandTotalVendorList.netTempamount) ? parseInt($scope.grandTotalVendorList.netTempamount): 0) - (parseInt(leak) ? parseInt(leak): 0);
	}
	$scope.resetCustomerInvoice =function(){
		$scope.customerInvoice={fromdate:"",todate:""};
		$scope.customerInvoiceJson =[];
		$scope.grandTotalList={totaltrip:"",customername:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
		$scope.leakage="";
	}
	$scope.resetVendorInvoice =function(){
		$scope.vendorInvoice={fromdate:"",todate:"",truckno:""};
		$scope.vendorInvoiceJson =[];
		$scope.grandTotalVendorList={totaltrip:"",vendorname:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
	}
	$scope.saveCustomerInvoice =function(){
		$scope.custPrintData={};
		$scope.custcallBackdata={invoiceid:"",loadnnumber:[]};
		
		angular.forEach($scope.checkedValue, function(list, key) {
    		$scope.custcallBackdata.loadnnumber.push(list.loadno);
    	});
		//$scope.grandTotalList.cancatload=$scope.custcallBackdata.loadnnumber;
		$scope.grandTotalList.cancatload=$scope.custcallBackdata.loadnnumber.map(function(obj){return obj;}).join(','); 
		if($scope.grandTotalList.truckType=="" && $scope.customerInvoiceJson ==""){
			 toastr.error("Sorry,Can't save before complete calculation");
			return;
		}/* else if($scope.grandTotalList.customerbranch==""){
			 toastr.error('Please enter Customer Branch');
			return;
		}else if($scope.grandTotalList.invoicedate==""){
			 toastr.error('Please enter Invoice Date');
			return;
		}else if($scope.grandTotalList.grandTotal==0 && scope.grandTotalList.itemDetails[0].item==""){
			 toastr.error('Please fill the required fields');
				return;
		} */
		else if($scope.grandTotalList.custinvoicedate =="" || $scope.grandTotalList.custinvoicedate == undefined){
			toastr.error('Invoice Date mandatory to proceed save');
		}else{
			var url = localurl +"/api/v1/createcustomerinvoice";
		    $http({
		        method : 'POST',
		        url : url,
		        data : angular.toJson($scope.grandTotalList),
		        headers : {
		        'Content-Type' : 'application/json'
		        }
		        }).then(function (response) {
		        	$scope.custcallBackdata.invoiceid=response.data.customerinvoiceid;
		        	
		        	$scope.custPrintData=response.data;
		        	$scope.custPrintData.tripRate =(parseInt($scope.custPrintData.totalkmpercharge) ? parseInt($scope.custPrintData.totalkmpercharge): 0) + (parseInt($scope.custPrintData.totalfreightamt) ? parseInt($scope.custPrintData.totalfreightamt): 0);
		        	$scope.custPrintData.advLeak =(parseInt($scope.custPrintData.totaladvance) ? parseInt($scope.custPrintData.totaladvance): 0) + (parseInt($scope.custPrintData.leakage) ? parseInt($scope.custPrintData.leakage): 0);
		        	$scope.custPrintData.totalAmountInWords = inWords(parseInt($scope.custPrintData.netamount));
		        	$scope.getCustDetails($scope.custPrintData.customername);
		        	
		        }, function error(response) {
		        	toastr.error('Data not added');
		          console.log(response.status);
		        });
		}
		}
	
	
	$scope.getCustDetails =function(data){
		
	 	//$scope.custDetailResp=[];
		var url=localurl +"/api/v1/customerlistbycusname?name="+data;
		 $http({
			    method : 'GET',
			    url : url
			    //params: data,
			   }).then(function successCallback(response) {
			  // $scope.custDetailResp = response.data[0];
				//$scope.custPrintData.custAddr = response.data[0].customerDetails[0].customerAddr ?  response.data[0].customerDetails[0].customerAddr :"";
				$scope.custPrintData.custAddr = response.data[0] ?  response.data[0] :"";
				$scope.updateBilledTrip($scope.custcallBackdata);
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   }); 
	}
	
	$scope.getVenDetails =function(data){
		
	 	//$scope.custDetailResp=[];
		var url=localurl +"/api/v1/vendoristbyvendname/"+data;
		 $http({
			    method : 'GET',
			    url : url
			    //params: data,
			   }).then(function successCallback(response) {
			  // $scope.custDetailResp = response.data[0];
			  $scope.venPrintData.venAddr = response.data[0][1] ?  response.data[0][1] :"";
			   $scope.updateVenBilledTrip($scope.vencallBackdata);
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   }); 
	}
	
	$scope.updateBilledTrip =function(data){
		var url = localurl +"/api/v1/updatecustomerinvoice";
		$http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson(data),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	        	if(response.data.status=="Updated Successfully"){
	        		$scope.customerInvoiceJson = [];
					$scope.checkedValue=[];
					$scope.grandTotalList={truckNo:"",truckType:"",totalKM:0,totalCase:0,totalPerKMCharge:0,totalfreightAmt:0,totalAdvance:0,totalDiscount:0,NetAmount:0};
					toastr.success('Billed successfully');
					$scope.custInvoicePrint();
	        	}
	        }, function error(response) {
	        	toastr.error('Not able to Bill');
	          console.log(response.status);
	        });
	}
$scope.saveVendorInvoice =function(){
	$scope.venPrintData={};
	$scope.vencallBackdata={invoiceid:"",loadnnumber:[]};
	
	angular.forEach($scope.checkedVendorValue, function(list, key) {
		$scope.vencallBackdata.loadnnumber.push(list.loadno);
	});
	//$scope.grandTotalVendorList.cancatload=$scope.vencallBackdata.loadnnumber;
	$scope.grandTotalVendorList.cancatload=$scope.vencallBackdata.loadnnumber.map(function(obj){return obj;}).join(','); 
	if($scope.grandTotalVendorList.truckType=="" && $scope.vendorInvoiceJson==''){
		 toastr.error("Sorry,Can't save before complete calculation");
		return;
	}else if($scope.grandTotalVendorList.veninvoicedate =="" ||$scope.grandTotalVendorList.veninvoicedate ==undefined){
		toastr.error('Invoice Date mandatory to proceed save');
	}else{
		var url = localurl +"/api/v1/createvendorinvoice";
		    $http({
		        method : 'POST',
		        url : url,
		        data : angular.toJson($scope.grandTotalVendorList),
		        headers : {
		        'Content-Type' : 'application/json' 
		        }
		        }).then(function (response) {
		        	$scope.vencallBackdata.invoiceid=response.data.vendorinvoiceid;
		        	
		        	$scope.venPrintData=response.data;
		        	$scope.venPrintData.tripRate =(parseInt($scope.venPrintData.totalkmpercharge) ? parseInt($scope.venPrintData.totalkmpercharge): 0) + (parseInt($scope.venPrintData.totalfreightamt) ? parseInt($scope.venPrintData.totalfreightamt): 0);
		        	$scope.venPrintData.advLeak =(parseInt($scope.venPrintData.totaladvance) ? parseInt($scope.venPrintData.totaladvance): 0) + (parseInt($scope.venPrintData.leakage) ? parseInt($scope.venPrintData.leakage): 0);
		        	$scope.venPrintData.totalAmountInWords = inWords(parseInt($scope.venPrintData.netamount));
		        	$scope.getVenDetails($scope.venPrintData.truckno);
		        	//$scope.updateVenBilledTrip($scope.vencallBackdata);
		            //toastr.success('Data added successfully');
		        }, function error(response) {
		        	toastr.success('Data not added');
		          console.log(response.status);
		        });
	}
	}
	
$scope.updateVenBilledTrip =function(data){
	var url = localurl +"/api/v1/updatevendorinvoice";
	$http({
        method : 'PUT',
        url : url,
        data : angular.toJson(data),
        headers : {
        'Content-Type' : 'application/json'
        }
        }).then(function (response) {
        	if(response.data.status=="Updated Successfully"){
        		$scope.vendorInvoiceJson = [];
				$scope.checkedVendorValue=[];
				$scope.grandTotalVendorList={totaltrip:"",vendorname:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
				toastr.success('Billed successfully');
				$scope.venInvoicePrint();
        	}
        }, function error(response) {
        	toastr.error('Not able to Bill');
          console.log(response.status);
        });
}
	$scope.custViewModal =function(data){
		$scope.custviewData =data;
		$scope.custviewData.tripRate =(parseInt($scope.custviewData.totalkmpercharge) ? parseInt($scope.custviewData.totalkmpercharge): 0) + (parseInt($scope.custviewData.totalfreightamt) ? parseInt($scope.custviewData.totalfreightamt): 0);
    	$scope.custviewData.advLeak =(parseInt($scope.custviewData.totaladvance) ? parseInt($scope.custviewData.totaladvance): 0) + (parseInt($scope.custviewData.leakage) ? parseInt($scope.custviewData.leakage): 0);
		$scope.custviewData.totalAmountInWords = inWords(parseInt($scope.custviewData.netamount));
		$("#custviewModal").modal("show");
	}
	$scope.showCustDetails =function(customer,data,amt,date){
		 $scope.custviewdetail={custviewAmt:"",custviewDateAmt:"",custname:""};
		 $scope.customerViewDetails=[];
		var url=localurl +"/api/v1/findtriprecordbycustomerinvoiceid?customerinvoiceid="+data;
		 $http({
			    method : 'GET',
			    url : url
			   }).then(function successCallback(response) {
			   $scope.customerViewDetails=response.data;
			   $scope.custviewdetail.custviewAmt=amt;
			   $scope.custviewdetail.custviewDateAmt=date;
			   $scope.custviewdetail.custname=customer;
			   $("#custViewDetailModal").modal("show");
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	}
	
	
	$scope.showVenDetails =function(customer,data,amt,date){
		 $scope.venviewdetail={venviewAmt:"",venviewDateAmt:"",venname:""};
		 $scope.vendorViewDetails=[];
		var url=localurl +"/api/v1/findtriprecordbyvendorinvoiceid?vendorinvoiceid="+data;
		 $http({
			    method : 'GET',
			    url : url
			   }).then(function successCallback(response) {
			   $scope.vendorViewDetails=response.data;
			   $scope.venviewdetail.venviewAmt=amt;
			   $scope.venviewdetail.venviewDateAmt=date;
			   $scope.venviewdetail.venname=customer;
			   $("#venViewDetailModal").modal("show");
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	}
	$scope.venViewModal =function(data){
		$scope.venviewData =data;
		$scope.venviewData.tripRate =(parseInt($scope.venviewData.totalkmpercharge) ? parseInt($scope.venviewData.totalkmpercharge): 0) + (parseInt($scope.venviewData.totalfreightamt) ? parseInt($scope.venviewData.totalfreightamt): 0);
    	$scope.venviewData.advLeak =(parseInt($scope.venviewData.totaladvance) ? parseInt($scope.venviewData.totaladvance): 0) + (parseInt($scope.venviewData.leakage) ? parseInt($scope.venviewData.leakage): 0);
		$scope.venviewData.totalAmountInWords = inWords(parseInt($scope.venviewData.netamount));
		$("#venviewModal").modal("show");
	}
	
	$scope.removevendorInvoice  =function(index){
		$scope.vendorInvoiceJson.splice(index,1);
	};
	$scope.closeVendorUpload =function(){
		$("#uploadVendorDiv").css("display","none");
	};
	$scope.openVendorUpload =function(){
		$("#uploadVendorDiv").css("display","block");
	};
	
	$scope.initView =function(){
		var url=localurl +"/api/v1/listcustomerinvoice";
		 $http({
			    method : 'GET',
			    url : url
			   }).then(function successCallback(response) {
			   $scope.customerViewList = response.data;
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	};
	$scope.initvenView =function(){
		var url=localurl +"/api/v1/listvendorinvoice";
		 $http({
			    method : 'GET',
			    url : url
			   }).then(function successCallback(response) {
			   $scope.vendorNameList = response.data;
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	};
	$scope.calculateAmountTax =function(data){
		console.log(data);
		var amt =$scope.customerInvoiceJson.amount * $scope.customerInvoiceJson.quantity;
		$scope.customerInvoiceJson.totalAmount =amt + amt * data;
	}
	
	$scope.getTotalTruckNo =function(){
		 $scope.trucknoJson = []; 
		 var url=localurl +"/api/v1/vehiclelist";
		 $http({
			    method : 'GET',
			    url : url,
			   }).then(function successCallback(response) {
			   //$scope.listCustJson = response.data;
			   
	           /*  var values = [ 
	            {name: 'Binary Search'}, 
	            {name: 'Linear Search'}, 
	            {name: 'Interpolation Search'} 
	            ];   
	            angular.forEach(values, function (value, key) { 
	                $scope.names.push(value.name); 
	            }); */ 
			   $scope.trucknoJson=response.data;
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	}
	
	
	$scope.maptoDescription =function(data){
		//$scope.manpower.description=data;
		data.description=data.item;
		//angular.forEach($scope.manpower,function(item,i){
			angular.forEach($scope.itemJson,function(value,index){
				 if(value.itemname==data.item){
					 data.hsn =value.hsncode;
					 data.taxpercentage=value.taxpercentage;
				 }
			 });
		$scope.getTotalItem(data);
		 
	}
	$scope.loadbindData =function(data){
		$scope.manpowerBilling.customerbranch="";
		 angular.forEach($scope.custlistJson,function(value,index){
		if(data==value.name){
			$scope.custAddr=value.address;
		}
		}) 
		//$scope.manpowerBilling.customerstate="";
	}
	$scope.loadbindStateData =function(data){
		//$scope.manpowerBilling.customerbranch="";
		 angular.forEach($scope.custAddr,function(value,index){
		if(data==value.customerAddr || data==value.vendoraddr){
			$scope.manpowerBilling.customerstate=value.state;
		}
		}) 
	}
	$scope.getItem =function(){
		$scope.manpowerBilling={customercode:"",customername:"",customerbranch:"",customerstate:"",grandTotal:0,invoicedate:""};
		$scope.savempItem={itemDetails:{}};
		$scope.grandTotal=0;
		$scope.manpower=[{item:"",description:"",hsn:"",quantity:0,unitprice:0,taxpercentage:"",total:0,withoutTax:0,igst:0,cgst:0,sgst:0}];
		 $scope.itemJson = []; 
		 var url=localurl +"/api/v1/manpowerinvoicestaticfeild";
		 $http({
			    method : 'GET',
			    url : url,
			   }).then(function successCallback(response) {
			   $scope.itemJson=response.data;
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	}
	$scope.getCustVenListmanPower =function(){
		//$scope.custlistJson=[{name:"",branch:""}];
		$scope.custlistJson=[];
		 $scope.users={name:"",code:"",address:""};
		 var url=localurl +"/api/v1/combinenameslist";
		 $http({
			    method : 'GET',
			    url : url,
			   }).then(function successCallback(response) {
			   //$scope.listCustJson = response.data;
			   angular.forEach(response.data,function(value,index){
				   if(value.customername || value.vendorname){
					   $scope.users.name=value.customername ? value.customername : value.vendorname;
					   $scope.users.code=value.customercode ? value.customercode : value.vendorcode;
					   if(value.customerDetails==undefined){
						   $scope.users.address=value.vendorAddress;
						  // $scope.users.state=value.vendorAddress[0].state ? value.vendorAddress[0].state : "";
					   }else if(value.vendorAddress==undefined){
						   $scope.users.address=value.customerDetails;
						   //$scope.users.state=value.customerDetails[0].state ? value.customerDetails[0].state : "";
					   }
					   
					   $scope.custlistJson.push(angular.copy($scope.users));
					   //$scope.custlistJson.push(value.customername ? value.customername : value.vendorname);  
				   }
				  
			   });
			
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	}
	$scope.getTotalItem =function(manpower){
		
		manpower.withoutTax =(parseInt(manpower.quantity)?parseInt(manpower.quantity):0) * (parseInt(manpower.unitprice)?parseInt(manpower.unitprice):0);
		manpower.igst= (parseInt(manpower.withoutTax)?parseInt(manpower.withoutTax):0) * ((parseInt(manpower.taxpercentage)?parseInt(manpower.taxpercentage):0)/100);
		manpower.cgst= (parseInt(manpower.igst)?parseInt(manpower.igst):0) /2;
		manpower.sgst= (parseInt(manpower.igst)?parseInt(manpower.igst):0) /2;
		manpower.total= (parseInt(manpower.withoutTax)?parseInt(manpower.withoutTax):0) +(parseInt(manpower.igst)?parseInt(manpower.igst):0);
		//$scope.grandItem();
		if($scope.manpowerBilling.customerstate=="Tamil Nadu"){
			manpower.igst=0;
		}else{
			manpower.cgst=0;
			manpower.sgst=0;
		}
		$scope.manpowerBilling.grandTotal=0;
		 angular.forEach($scope.manpower,function(value,index){
				$scope.manpowerBilling.grandTotal +=(parseInt(value.total)?parseInt(value.total):0);
			 });
	}
	
	/* $scope.grandItem =function(){
		
	} */
	
	 $scope.savemanPowerItem =function(){
		$scope.savempItem=$scope.manpowerBilling;
		$scope.savempItem.itemDetails=$scope.manpower;
		if($scope.savempItem.grandTotal){
			$scope.grandTotalAmtInWords=inWords(parseInt($scope.savempItem.grandTotal));
		}
		if($scope.savempItem.customername==""){
			 toastr.error('Please enter CustomerName');
			return;
		}else if($scope.savempItem.customerbranch==""){
			 toastr.error('Please enter Customer Branch');
			return;
		}/* else if($scope.savempItem.customerstate==""){
			 toastr.error('Please enter Customer State');
			return;
		} */else if($scope.savempItem.invoicedate==""){
			 toastr.error('Please enter Invoice Date');
			return;
		}else if($scope.savempItem.grandTotal==0 && scope.savempItem.itemDetails[0].item==""){
			 toastr.error('Please fill the required fields');
				return;
		}else{
			  var url=localurl +"/api/v1/manpowercreate";
			   $http({
			        method : 'POST',
			        url : url,
			        data : angular.toJson($scope.savempItem),
			        headers : {
			        'Content-Type' : 'application/json'
			        }
			        }).then(function (response) {
			        	
			        console.log(response);
			        	if(response.status==200){
			        		toastr.success('Added Successfully...');
			        		
			        		$scope.savemanPowerItemPrint();
			        		 /* angular.forEach($scope.manpower,function(value,index){
			     				$scope.manpowerBilling.grandTotal +=(parseInt(value.total)?parseInt(value.total):0);
			     			 }); */
			        	}
			        }, function error(response) {
			        	toastr.error('Error while Payment process');
			          console.log(response.status);
			        }); 
		}
		//$scope.savempItem.grandTotal=$scope.grandTotal;
		
	}
	
	$scope.savemanPowerItemPrint=function() {
		var xmlhttp;
		if (window.XMLHttpRequest) {// code for IE7+, Firefox, Chrome, Opera, Safari
			xmlhttp = new XMLHttpRequest();
			var mprintWindows = $window.open('', '', 'width=2000,height=1000');
			mprintWindows.document.write('<html><head><title>Man Power Invoice</title><link rel="stylesheet" type="text/css" href="css/pdfstyle.css"></head><body>');
			$(mprintWindows.document.body).append($("div[id=manPowerInvoice]").clone(true));
			mprintWindows.document.write('</body></html>');
			setTimeout(function(){ 
			$(mprintWindows)[0].focus();
			$(mprintWindows)[0].print();
			$(mprintWindows)[0].close();
			scope.resetItem();
			 }, 1000);
		} else {// code for IE6, IE5
			xmlhttp = new ActiveXObject("Microsoft.XMLHTTP");
		}
		xmlhttp.onreadystatechange = function() {
			if (xmlhttp.readyState == 4 && xmlhttp.status == 200) {
				document.getElementById("mPrintDiv").innerHTML = xmlhttp.responseText;
			}
		}
		
		xmlhttp.send();
	}
	
	$scope.resetItem=function(){
		$scope.manpower=[{item:"",description:"",hsn:"",quantity:0,unitprice:0,taxpercentage:"",total:0,withoutTax:0,igst:0,cgst:0,sgst:0}];
		$scope.grandTotal=0;
		$scope.manpowerBilling={customercode:"",customername:"",customerbranch:"",customerstate:"",grandTotal:"",invoicedate:""};
		$scope.savempItem={itemDetails:{}};
	}
	$scope.addRowItem = function(data){
		$scope.manpower.push({item:"",description:"",hsn:"",quantity:0,unitprice:0,taxpercentage:"",total:0,withoutTax:0,igst:0,cgst:0,sgst:0});
	}
	$scope.deleteRowItem = function(index){
		$scope.manpower.splice(index,1);
	}
	 $scope.initmpcustList =function(){
		 $scope.mpCustomerlist=[];
		 var url=localurl +"/api/v1/customerlist";
		 $http({
			    method : 'GET',
			    url : url,
			   }).then(function successCallback(response) {
			   $scope.mpCustomerlist=response.data;
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	 }
	 
	 $scope.initmpvenList =function(){
		 $scope.mpVendorlist=[];
			 var url=localurl +"/api/v1/vendorlist";
			 $http({
				    method : 'GET',
				    url : url,
				   }).then(function successCallback(response) {
					   $scope.mpVendorlist=response.data;
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		 }
	 
		$scope.searchmpItem =function(){
			$scope.mpInvoiceJson=[];
			if($scope.mpInvoice.fromdate=="" || $scope.mpInvoice.fromdate== undefined){
				 toastr.error('Please enter From date');
				return;
			}else if($scope.mpInvoice.todate=="" || $scope.mpInvoice.todate==undefined){
				 toastr.error('Please enter To date');
				return;
			}else if($scope.mpInvoice.customername=="" || $scope.mpInvoice.customername== undefined){
				 toastr.error('Please enter CustomerName');
				return;
			}else{
				var url=localurl +"/api/v1/listcustomerbydatename";
				 $http({
					    method : 'GET',
					    url : url,
					    params: $scope.mpInvoice,
					   }).then(function successCallback(response) {
					   $scope.mpInvoiceJson = response.data;
					   }, function errorCallback(response) {
					    console.log(response.statusText);
					   });
			}
			
		};

	$scope.navRedirect =function(event){
		 $(".nav").find(".active").removeClass("active");
		   $(event).addClass("active");
		   var currEvent=$(event.target).attr('bind-attr');
		  if(currEvent =="customerView"){
			  $('#CustomerInvoice').hide();
			  $('#VendorInvoice').hide();
			  $('#customerView').show();
			  $('#customerView').addClass("active");
			  //$scope.initView();
		  }else if(currEvent =="VendorInvoice"){
			  $('#CustomerInvoice').hide();
			  $('#VendorInvoice').show();
			  $('#customerView').hide();
			  $('#VendorInvoice').addClass("active");
			  $('#vendorView').hide();
			  $scope.getTotalTruckNo();
			  var vm = $scope;
				vm.dtInstanceCallback = function(instance) {
				 	vm.dtInstance = instance;
		    };
		    
		    vm.dtOptions = DTOptionsBuilder.newOptions()
				        .withOption('scrollY', '300px')
				        .withOption('scrollX', '100%')
				        .withOption('scrollCollapse', true)
				        .withFixedColumns({
				            leftColumns: 1,
				            rightColumns: 1
				        }); 
		   $scope.grandTotalVendorList={totaltrip:"",vendorname:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
		  }else if(currEvent =="CustomerInvoice"){
			  $('#CustomerInvoice').show();
			  $('#CustomerInvoice').addClass("active");
			  $('#VendorInvoice').hide();
			  $('#customerView').hide();
			  $('#vendorView').hide();
			 $scope.grandTotalList={totaltrip:"",customername:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
		  }else if(currEvent =="manPowerBilling"){
			  $('#manPowerBilling').show();
			  $('#manPowerBilling').addClass("active");
			  $('#CustomerInvoice').hide();
			  $('#VendorInvoice').hide();
			  $('#customerView').hide();
			  $('#vendorView').hide();
			  $scope.getCustVenListmanPower();
			  $scope.getItem();
			 $scope.grandTotalList={totaltrip:"",customername:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
		  }else if(currEvent =="manPowerView"){
			  $('#manPowerBilling').hide();
			  $('#manPowerView').show();
			  $('#manPowerView').addClass("active");
			  $('#CustomerInvoice').hide();
			  $('#VendorInvoice').hide();
			  $('#customerView').hide();
			  $('#vendorView').hide();
			  //$scope.initmpcustList();
			  //$scope.initmpvenList();
			  $scope.getCustVenListmanPower();
			  //$scope.getItem();
			 //$scope.grandTotalList={totaltrip:"",customername:"",invoiceNo:"",truckno:"",trucktype:"",totalkm:0,totalcase:0,totalkmpercharge:0,totalfreightamt:0,totaladvance:0,totaldiscount:0,netamount:0,paymentstatus:"",receiptnumber:"",leakage:"",cancatload:""};
		  }else{
			  $('#vendorView').show();
			  $('#vendorView').addClass("active");
			  $('#CustomerInvoice').hide();
			  $('#VendorInvoice').hide();
			  $('#customerView').hide();
			  $scope.initvenView();
		  }
	}
	$scope.init_Billing();
	scope=$scope;
});
app.controller('ReceiptController', function ($scope,$timeout,$http,toastr,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder) {
	
	$scope.listReceiptJson =[{instrumentType: "Sew",shipperName: "xyzz", consignorName: "ABCCC", billingDetails: {}},
							  {instrumentType: "Software",shipperName: "ABCCC", consignorName: "ABCCC", billingDetails: {}},
							  {instrumentType: "Equipment",shipperName: "ABCCC", consignorName: "ABCCC",billingDetails: {}},
							  {instrumentType: "sonaata",shipperName: "ABCCC", consignorName: "ABCCC", billingDetails: {}}];				
	
	$scope.paymentJson =[{paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}];	
	$scope.paymentvenJson =[{paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}];	
	 $scope.customerpaymentList =[];
	 $scope.vendorpaymentList =[];
	$scope.customerPayment={fromdate:"",todate:""};
	$scope.vendorPayment={fromdate:"",todate:"",vendorname:""};
	$scope.checkedcustPaymentValue=[];
	$scope.checkedvenPaymentValue=[];
	$scope.commoncustList={custreceiptDate:"",totalamount:0};
	$scope.commonvenList={venreceiptDate:"",totalamount:0};
	
	  
	$scope.dtInstanceCallback = function(instance) {
		$scope.dtInstance = instance;
 	};
 
 	$scope.dtOptions = DTOptionsBuilder.newOptions()
		        .withOption('scrollY', '300px')
		        .withOption('scrollX', '100%')
		        .withOption('scrollCollapse', true)
		        .withFixedColumns({
		            leftColumns: 1,
		            rightColumns: 1
		        });
	$scope.deletepaymentIndex =function(index){
		$scope.paymentJson.splice(index,1);		
	}
 	$scope.addNewpayment =function(){
 		$scope.paymentJson.push({paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}); 		
 	}
 	$scope.calculatepaymentTotal =function(){
 		$scope.commoncustList={custreceiptDate:"",totalamount:0};
 		$scope.paymentJson =[{paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}];
 		$scope.existCustomerName=$scope.checkedcustPaymentValue[0].customername;
 		angular.forEach($scope.checkedcustPaymentValue, function(value, key) {
 			if($scope.existCustomerName == value.customername){
 				$scope.commoncustList.totalamount +=parseInt(value.netamount)?parseInt(value.netamount):0;
 			}else{
 				toastr.warning('Please check same customer');
 				$scope.commoncustList.totalamount =0;
 				$scope.existCustomerName="";
 				return;
 			}
 			
		});
 	}
 	$scope.calculatevenpaymentTotal =function(){
 		$scope.commonvenList={venreceiptDate:"",totalamount:0};
 		$scope.paymentvenJson =[{paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}];
 		$scope.existVendorName=$scope.checkedvenPaymentValue[0].vendorname;
 		angular.forEach($scope.checkedvenPaymentValue, function(value, key) {
 			if($scope.existVendorName == value.vendorname){
 				$scope.commonvenList.totalamount +=parseInt(value.netamount)?parseInt(value.netamount):0;
 			}else{
 				toastr.warning('Please check same vendor');
 				$scope.commonvenList.totalamount =0;
 				$scope.existVendorName ="";
 				return;
 			}
		});
 	}
 $scope.checkcustPayInArray =function(item){
	 if(item.checked) {
	      $scope.checkedcustPaymentValue.push(item);
	    } else {
	       var newIndex = $scope.checkedcustPaymentValue.map(function(e) { return e.customerinvoiceid; }).indexOf(item.customerinvoiceid);
	       // for compare instead of "loadNo" you should use that field is unique. ie: e.uniqueField
	       // and $scope.customerInvoiceJson[index].uniqueField
	       if(newIndex !== -1)
	          $scope.checkedcustPaymentValue.splice(newIndex,1);
	    }
 }
 
 $scope.checkvenPayInArray =function(item){
	 if(item.checked) {
	      $scope.checkedvenPaymentValue.push(item);
	    } else {
	       var newIndex = $scope.checkedvenPaymentValue.map(function(e) { return e.vendorinvoiceid; }).indexOf(item.vendorinvoiceid);
	       // for compare instead of "loadNo" you should use that field is unique. ie: e.uniqueField
	       // and $scope.customerInvoiceJson[index].uniqueField
	       if(newIndex !== -1)
	          $scope.checkedvenPaymentValue.splice(newIndex,1);
	    }
 }
 
 $scope.searchcustPaymentItem =function(){
		if($scope.customerPayment.fromdate=="" || $scope.customerPayment.fromdate== undefined){
			 toastr.error('Please enter From date');
			return;
		}else if($scope.customerPayment.todate=="" || $scope.customerPayment.todate==undefined){
			 toastr.error('Please enter To date');
			return;
		}/* else if($scope.customerPayment.customername=="" || $scope.customerPayment.customername== undefined){
			 toastr.error('Please enter CustomerName');
			return;
		} */else{
			var url=localurl +"/api/v1/invoicelistincustomer";
			 $http({
				    method : 'GET',
				    url : url,
				    params: $scope.customerPayment,
				   }).then(function successCallback(response) {
				   $scope.customerpaymentList = response.data;
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		}
		
	};
	
	 $scope.searchvenPaymentItem =function(){
			if($scope.vendorPayment.fromdate=="" || $scope.vendorPayment.fromdate== undefined){
				 toastr.error('Please enter From date');
				return;
			}else if($scope.vendorPayment.todate=="" || $scope.vendorPayment.todate==undefined){
				 toastr.error('Please enter To date');
				return;
			}else if($scope.vendorPayment.vendorname=="" || $scope.vendorPayment.vendorname== undefined){
				 toastr.error('Please enter CustomerName');
				return;
			}else{
				var url=localurl +"/api/v1/vendorinvoicelistinvendor";
				 $http({
					    method : 'GET',
					    url : url,
					    params: $scope.vendorPayment,
					   }).then(function successCallback(response) {
					   $scope.vendorpaymentList = response.data;
					   }, function errorCallback(response) {
					    console.log(response.statusText);
					   });
			}
			
		};
		
		 $scope.searchcustPaymentItemView =function(){
				if($scope.customerPaymentView.fromdate=="" || $scope.customerPaymentView.fromdate== undefined){
					 toastr.error('Please enter From date');
					return;
				}else if($scope.customerPaymentView.todate=="" || $scope.customerPaymentView.todate==undefined){
					 toastr.error('Please enter To date');
					return;
				}else if($scope.customerPaymentView.customername=="" || $scope.customerPaymentView.customername== undefined){
					 toastr.error('Please enter CustomerName');
					return;
				}else{
					var url=localurl +"/api/v1/customerinvoicebydatename";
					 $http({
						    method : 'GET',
						    url : url,
						    params: $scope.customerPaymentView,
						   }).then(function successCallback(response) {
						   $scope.customerpaymentListView = response.data;
						   }, function errorCallback(response) {
						    console.log(response.statusText);
						   });
				}
				
			};
			
			$scope.searchvenPaymentItemView =function(){
				if($scope.vendorPaymentView.fromdate=="" || $scope.vendorPaymentView.fromdate== undefined){
					 toastr.error('Please enter From date');
					return;
				}else if($scope.vendorPaymentView.todate=="" || $scope.vendorPaymentView.todate==undefined){
					 toastr.error('Please enter To date');
					return;
				}else if($scope.vendorPaymentView.vendorname=="" || $scope.vendorPaymentView.vendorname== undefined){
					 toastr.error('Please enter CustomerName');
					return;
				}else{
					var url=localurl +"/api/v1/vendorinvoicelistinvendor";
					 $http({
						    method : 'GET',
						    url : url,
						    params: $scope.vendorPaymentView,
						   }).then(function successCallback(response) {
						   $scope.vendorpaymentListView = response.data;
						   }, function errorCallback(response) {
						    console.log(response.statusText);
						   });
				}
				
			};
		 $scope.searchmanpowerviewDetails =function(){
			 $scope.mppaymentViewList=[];
				/* if($scope.manpowerview.fromdate=="" || $scope.manpowerview.fromdate== undefined){
					 toastr.error('Please enter From date');
					return;
				}else if($scope.manpowerview.todate=="" || $scope.manpowerview.todate==undefined){
					 toastr.error('Please enter To date');
					return;
				}else if($scope.manpowerview.customername=="" || $scope.manpowerview.customername== undefined){
					 toastr.error('Please enter CustomerName');
					return;
				}else{ */
					var url=localurl +"/api/v1/listcustomerbydatenamecompletestatus";
					 $http({
						    method : 'GET',
						    url : url,
						    params: $scope.manpowerview,
						   }).then(function successCallback(response) {
						   $scope.mppaymentViewList = response.data;
						   }, function errorCallback(response) {
						    console.log(response.statusText);
						   });
				//}
				
			};
	$scope.saveCustPayment =function(){
		$scope.custPaymentcallBackdata={paymentid:"",invoiceid:[]};
		$scope.custPaymentsubmitData={customerreceiptdate:$scope.commoncustList.custreceiptDate,customerpayment:[]};
		$scope.custPaymentsubmitData.customerpayment=$scope.paymentJson;
		var url = localurl +"/api/v1/createcustomerpayment";
		$scope.checkCredit=false;
		$scope.checkamt=0;
		angular.forEach($scope.paymentJson, function(value, key) {
			if(value.paymenttype =="Credit"){
				$scope.checkCredit=true;
			}
			if($scope.existCustomerName){
				value.customername =$scope.existCustomerName;
			}else{
				toastr.warning('Please check same customer');
				return;
			}
			
			$scope.checkamt +=parseInt(value.amount)?parseInt(value.amount):0;
 			//$scope.commoncustList.totalamount +=parseInt(value.netamount)?parseInt(value.netamount):0;;
		});
		
		if($scope.commoncustList.totalamount == 0){
		toastr.warning('No data');
		return;	
		}
		if($scope.commonvenList.custreceiptDate ==""){
			toastr.warning('Please select Receipt Date..');
			return;	
		}
		if($scope.checkCredit){
			if($scope.commoncustList.totalamount ==$scope.checkamt){
				//toastr.success('matched');
				
				    $http({
				        method : 'POST',
				        url : url,
				        data : angular.toJson($scope.custPaymentsubmitData),
				        headers : {
				        'Content-Type' : 'application/json'
				        }
				        }).then(function (response) {
				            $scope.custPaymentcallBackdata.paymentid=response.data.cuspaymentid;
				        	angular.forEach($scope.checkedcustPaymentValue, function(list, key) {
				        		$scope.custPaymentcallBackdata.invoiceid.push(list.customerinvoiceid);
				        	});
				        	$scope.updatecustomerInvoice();
				        }, function error(response) {
				        	toastr.error('Error while Payment process');
				          console.log(response.status);
				        });
			}else{
				toastr.error('Amount does not match');
			}
			
		}else{
			if($scope.commoncustList.totalamount <=$scope.checkamt){
				//toastr.success('Matched');
				$http({
			        method : 'POST',
			        url : url,
			        data : angular.toJson($scope.custPaymentsubmitData),
			        headers : {
			        'Content-Type' : 'application/json'
			        }
			        }).then(function (response) {
			            //$scope.listCustomerJson = response.data;
			           // toastr.success('Data added successfully');
			            $scope.custPaymentcallBackdata.paymentid=response.data.cuspaymentid;
			        	angular.forEach($scope.checkedcustPaymentValue, function(list, key) {
			        		$scope.custPaymentcallBackdata.invoiceid.push(list.customerinvoiceid);
			        	});
			        	$scope.updatecustomerInvoice();
			        }, function error(response) {
			        	toastr.error('Error while Payment process');
			          console.log(response.status);
			        });
			}else{
				toastr.error('Invoice and Receipt Amount is not matched..');
			}
			
		}
	}
	
	$scope.updatecustomerInvoice=function(){
		var url = localurl +"/api/v1/updatecustomerpaymentid";
		$http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.custPaymentcallBackdata),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Payment registered successfully');
	            $scope.initcustPayment();
	        }, function error(response) {
	        	toastr.error('Payment not registered');
	          console.log(response.status);
	        });
	}
	
	
	
	$scope.saveVenPayment =function(){
		
		$scope.venPaymentcallBackdata={paymentid:"",invoiceid:[]};
		$scope.venPaymentsubmitData={vendorreceiptdate:$scope.commonvenList.venreceiptDate,vendorpayment:[]};
		$scope.venPaymentsubmitData.vendorpayment=$scope.paymentvenJson;
		var url = localurl +"/api/v1/createvendorpayment";
		$scope.checkvenCredit=false;
		$scope.checkvenamt=0;
		angular.forEach($scope.paymentvenJson, function(value, key) {
			if(value.paymenttype =="Credit"){
				$scope.checkvenCredit=true;
			}
			if($scope.existVendorName){
				value.vendorname =$scope.existVendorName;
			}else{
				toastr.warning('Please check same vendor');
				return;
			}
			$scope.checkvenamt +=parseInt(value.amount)?parseInt(value.amount):0;
		});
		if($scope.commonvenList.totalamount == 0){
			toastr.warning('No data');
			return;	
		}
		if($scope.commonvenList.venreceiptDate ==""){
			toastr.warning('Please select Receipt Date..');
			return;	
		}
		if($scope.checkvenCredit){
			if($scope.commonvenList.totalamount ==$scope.checkvenamt){
				//toastr.success('matched');
				
				    $http({
				        method : 'POST',
				        url : url,
				        data : angular.toJson($scope.venPaymentsubmitData),
				        headers : {
				        'Content-Type' : 'application/json'
				        }
				        }).then(function (response) {
				            $scope.venPaymentcallBackdata.paymentid=response.data.vendpaymentid;
				        	angular.forEach($scope.checkedvenPaymentValue, function(list, key) {
				        		$scope.venPaymentcallBackdata.invoiceid.push(list.vendorinvoiceid);
				        	});
				        	$scope.updatevendorInvoice();
				        }, function error(response) {
				        	toastr.error('Error while Payment process');
				          console.log(response.status);
				        });
			}else{
				toastr.error('Amount does not match');
			}
			
		}else{
			if($scope.commonvenList.totalamount <=$scope.checkvenamt){
				//toastr.success('Matched');
				$http({
			        method : 'POST',
			        url : url,
			        data : angular.toJson($scope.venPaymentsubmitData),
			        headers : {
			        'Content-Type' : 'application/json'
			        }
			        }).then(function (response) {
			            //$scope.listCustomerJson = response.data;
			           // toastr.success('Data added successfully');
			        	$scope.venPaymentcallBackdata.paymentid=response.data.venpaymentid;
			        	angular.forEach($scope.checkedvenPaymentValue, function(list, key) {
			        		$scope.venPaymentcallBackdata.invoiceid.push(list.vendorinvoiceid);
			        	});
			        	$scope.updatevendorInvoice();
			        }, function error(response) {
			        	toastr.error('Error while Payment process');
			          console.log(response.status);
			        });
			}else{
				toastr.error('Invoice and Receipt Amount is not matched..');
			}
			
		}
	}
	
	$scope.updatevendorInvoice=function(){
		var url = localurl +"/api/v1/updatevendorpaymentid";
		$http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.venPaymentcallBackdata),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            toastr.success('Payment registered successfully');
	            $scope.initvenPayment();
	        }, function error(response) {
	        	toastr.error('Payment not registered');
	          console.log(response.status);
	        });
	}
	
	/* $scope.calculatePaymentAmountTax =function(data){
		console.log(data);
		var amt =$scope.paymentJson.amount * $scope.paymentJson.quantity;
		$scope.paymentJson.totalAmount =amt + amt * data;
	} */
	$scope.init_Inst =function(){
		 $('#datetimepicker_custfromrepbill').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custtorepbill').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_venfromrepbill').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_ventorepbill').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custreceiptDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_venreceiptDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custfrompaymp').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custtopaymp').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_mpreceiptDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_mpinstDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custfromcustpayview').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custtocustpayview').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 
		 $('#datetimepicker_custfromvenpayview').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custtovenpayview').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $scope.initcustPayment();
	}
	
	 
	 
	 $('#datetimepicker_startBillDate1').datetimepicker({
	        format: 'DD/MM/YYYY'
	    });
	    $('#datetimepicker_endBillDate2').datetimepicker({
	        format: 'DD/MM/YYYY'
	    });
	    
	    $scope.initcustPayment =function(){
	    	$scope.paymentJson =[{paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}];
	    	$scope.customerpaymentList =[];
	    	$scope.customerpayList =[];
	    	$scope.customerPayment={fromdate:"",todate:""};
	    	$scope.checkedcustPaymentValue=[];
	    	$scope.commoncustList={custreceiptDate:"",totalamount:0};
	    	$scope.customerpaymentList=[];
			var url=localurl +"/api/v1/listcustomerinvoice";
			 $http({
				    method : 'GET',
				    url : url
				   }).then(function successCallback(response) {
				   $scope.customerpayList = response.data;
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		};
		
	 $scope.initvenPayment =function(){
		 $scope.paymentvenJson =[{paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}];	
		 $scope.vendorpaymentList =[];
		 $scope.vendorPayment={fromdate:"",todate:"",vendorname:""};
		 $scope.checkedvenPaymentValue=[];
		 $scope.vendorpaymentList=[];
		 $scope.commonvenList={venreceiptDate:"",totalamount:0};
			var url=localurl +"/api/v1/listvendorinvoice";
			 $http({
				    method : 'GET',
				    url : url
				   }).then(function successCallback(response) {
				   $scope.vendorpayList = response.data;
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		};
		
		 $scope.searchmanpowerPaymentItem =function(){
				if($scope.customermanpowerPay.fromdate=="" || $scope.customermanpowerPay.fromdate== undefined){
					 toastr.error('Please enter From date');
					return;
				}else if($scope.customermanpowerPay.todate=="" || $scope.customermanpowerPay.todate==undefined){
					 toastr.error('Please enter To date');
					return;
				}else if($scope.customermanpowerPay.customername=="" || $scope.customermanpowerPay.customername== undefined){
					 toastr.error('Please enter CustomerName');
					return;
				}else{
					var url=localurl +"/api/v1/listcustomerbydatename";
					 $http({
						    method : 'GET',
						    url : url,
						    params: $scope.customermanpowerPay,
						   }).then(function successCallback(response) {
						   $scope.customerpaymentList = response.data;
						   }, function errorCallback(response) {
						    console.log(response.statusText);
						   });
				}
				
			};		
			
	$scope.getPayItem =function(){
		$scope.customermanpowerPay={fromdate:"",todate:"",customername:""};
    	$scope.checkedmanpowerPaymentValue=[];
    	$scope.commonmpList={custreceiptDate:"",totalamount:0};
		 $scope.customervendorpayList=[];
		 var url=localurl +"/api/v1/combinenameslist";
		 $http({
			    method : 'GET',
			    url : url,
			   }).then(function successCallback(response) {
			   //$scope.listCustJson = response.data;
			   angular.forEach(response.data,function(value,index){
				   if(value.customername || value.vendorname){
					   $scope.customervendorpayList.push(value.customername ? value.customername : value.vendorname);  
				   }
				   
			   });
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	}
	
	$scope.checkmanpowerPayInArray =function(item){
		 if(item.checked) {
		      $scope.checkedmanpowerPaymentValue.push(item);
		    } else {
		       var newIndex = $scope.checkedmanpowerPaymentValue.map(function(e) { return e.customerinvoiceid; }).indexOf(item.customerinvoiceid);
		       // for compare instead of "loadNo" you should use that field is unique. ie: e.uniqueField
		       // and $scope.customerInvoiceJson[index].uniqueField
		       if(newIndex !== -1)
		          $scope.checkedmanpowerPaymentValue.splice(newIndex,1);
		    }
	 }
	$scope.calculatemanpowerpaymentTotal =function(){
 		$scope.commonmpList={custreceiptDate:"",totalamount:0};
 		$scope.mppaymentJson =[{paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}];
 		$scope.existmpCustomerName=$scope.checkedmanpowerPaymentValue[0].customername;
 		angular.forEach($scope.checkedmanpowerPaymentValue, function(value, key) {
 			if($scope.existmpCustomerName == value.customername){
 				$scope.commonmpList.totalamount +=parseInt(value.grandTotal)?parseInt(value.grandTotal):0;
 			}else{
 				toastr.warning('Please tick same customer');
 				$scope.commonmpList.totalamount =0;
 				$scope.existmpCustomerName="";
 				return;
 			}
 			
		});
 	}
	$scope.deleteMppaymentIndex =function(index){
		$scope.mppaymentJson.splice(index,1);		
	}
 	$scope.addNewMppayment =function(){
 		$scope.mppaymentJson.push({paymenttype: "",instrumentdate: "", amount: "", instrumentno:""}); 		
 	}
	$scope.savempPayment =function(){
		$scope.mpPaymentcallBackdata={paymentid:"",invoiceid:[]};
		$scope.mpPaymentsubmitData={customerreceiptdate:$scope.commonmpList.custreceiptDate,customerpayment:[]};
		$scope.mpPaymentsubmitData.customerpayment=$scope.mppaymentJson;
		var url = localurl +"/api/v1/createmanpowerpayment";
		$scope.checkCredit=false;
		$scope.checkmpamt=0;
		angular.forEach($scope.mppaymentJson, function(value, key) {
			if(value.paymenttype =="Credit"){
				$scope.checkCredit=true;
			}
			if($scope.existmpCustomerName){
				value.customername =$scope.existmpCustomerName;
			}else{
				toastr.warning('Please tick same customer');
				return;
			}
			
			$scope.checkmpamt +=parseInt(value.amount)?parseInt(value.amount):0;
 			//$scope.commoncustList.totalamount +=parseInt(value.netamount)?parseInt(value.netamount):0;;
		});
		
		if($scope.commonmpList.totalamount == 0){
		toastr.warning('No data');
		return;	
		}
		if($scope.commonmpList.custreceiptDate ==""){
			toastr.warning('Please select Receipt Date..');
			return;	
		}
		if($scope.checkCredit){
			if($scope.commonmpList.totalamount ==$scope.checkmpamt){
				//toastr.success('matched');
				
				    $http({
				        method : 'POST',
				        url : url,
				        data : angular.toJson($scope.mpPaymentsubmitData),
				        headers : {
				        'Content-Type' : 'application/json'
				        }
				        }).then(function (response) {
				            $scope.mpPaymentcallBackdata.paymentid=response.data.status;
				        	angular.forEach($scope.checkedmanpowerPaymentValue, function(list, key) {
				        			$scope.mpPaymentcallBackdata.invoiceid.push(list.manpowerid);
				        	});
				        	$scope.updatempInvoice();
				        }, function error(response) {
				        	toastr.error('Error while Payment process');
				          console.log(response.status);
				        });
			}else{
				toastr.error('Amount does not match');
			}
			
		}else{
			if($scope.commoncustList.totalamount <=$scope.checkamt){
				//toastr.success('Matched');
				$http({
			        method : 'POST',
			        url : url,
			        data : angular.toJson($scope.custPaymentsubmitData),
			        headers : {
			        'Content-Type' : 'application/json'
			        }
			        }).then(function (response) {
			            //$scope.listCustomerJson = response.data;
			           // toastr.success('Data added successfully');
			            $scope.mpPaymentcallBackdata.paymentid=response.data.status;
			        	angular.forEach($scope.checkedmanpowerPaymentValue, function(list, key) {
			        		$scope.mpPaymentcallBackdata.invoiceid.push(list.manpowerid);
			        	});
			        	$scope.updatempInvoice();
			        }, function error(response) {
			        	toastr.error('Error while Payment process');
			          console.log(response.status);
			        });
			}else{
				toastr.error('Invoice and Receipt Amount is not matched..');
			}
			
		}
	}
	$scope.updatempInvoice=function(){
		var url = localurl +"/api/v1/updatemanpowerpaymentid";
		$http({
	        method : 'PUT',
	        url : url,
	        data : angular.toJson($scope.mpPaymentcallBackdata),
	        headers : {
	        'Content-Type' : 'application/json'
	        }
	        }).then(function (response) {
	            //$scope.listCustomerJson = response.data;
	            toastr.success('Payment registered successfully');
	            $scope.getPayItem();
	        }, function error(response) {
	        	toastr.error('Payment not registered');
	          console.log(response.status);
	        });
	}
	$scope.getmpInitialize=function(){
		 $('#datetimepicker_custfromviewdetails').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_custtoviewdetails').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $scope.getPayItem();
	}
	$scope.initcustPaymentView=function(){
		$scope.customerPaymentView={fromdate:"",todate:"",customername:""};
	 }
 	$scope.initvenPaymentView=function(){
 		$scope.vendorPaymentView={fromdate:"",todate:"",vendorname:""};
	 }
	$scope.navRedirect =function(event){
		
		 $(".nav").find(".active").removeClass("active");
		   $(event).addClass("active");
		   var currEvent=$(event.target).attr('bind-attr');
		  if(currEvent =="view"){
			  $('#Payment').hide();
			  $('#Receipt').hide();
			  $('#view').show();
			  $('#manpowerReceipt').hide();
			  $('#vendorview').hide();
			  $('#manpowerview').hide();
			  $scope.initcustPaymentView();
		  }else if(currEvent =="vendorview"){
			  $('#Payment').hide();
			  $('#Receipt').hide();
			  $('#view').hide();
			  $('#vendorview').show();
			  $('#manpowerReceipt').hide();
			  $('#manpowerview').hide();
			  $scope.initvenPaymentView();
		  }else if(currEvent =="vendorPayment"){
			  $('#Payment').hide();
			  $('#Receipt').show();
			  $('#view').hide();
			  $('#manpowerReceipt').hide();
			  $('#vendorview').hide();
			  $('#manpowerview').hide();
			  $scope.initvenPayment();
		  }else if(currEvent =="manpowerReceipt"){
			  $('#Payment').hide();
			  $('#Receipt').hide();
			  $('#view').hide();
			  $('#manpowerReceipt').show();
			  $('#vendorview').hide();
			  $('#manpowerview').hide();
			  $scope.getPayItem();
			  //$scope.getCustVenListmanPowerpay();
		  }else if(currEvent =="manpowerview"){
			  $('#Payment').hide();
			  $('#Receipt').hide();
			  $('#view').hide();
			  $('#manpowerReceipt').hide();
			  $('#manpowerview').show();
			  $('#vendorview').hide();
			  $scope.getmpInitialize();
			  //$scope.getCustVenListmanPowerpay();
		  }else{
			  $('#Payment').show();
			  $('#Receipt').hide();
			  $('#view').hide();
			  $('#vendorview').hide();
			  $('#manpowerReceipt').hide();
			  $('#manpowerview').hide();
			  //$scope.initcustPayment();
		  }
	}
	$scope.init_Inst();
	
	 /* $timeout(function() { 
		   $('#datetimepicker_custinstDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });  
		 $('#datetimepicker_veninstDate').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 
		 }, 2000); */
	scope=$scope;
});

app.controller('VoucherController', function ($scope,$timeout,$http,toastr,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder) {
	$scope.custCreditList=[];
	$scope.custCreditStatusList=[];
	 $scope.checkedcustvoucher=[];
	 //$scope.checkedcustvoucherstatus=[];
	 $scope.venCreditList=[];
	 $scope.venCreditStatusList=[];
	 $scope.checkedvenvoucher=[];
	// $scope.checkedvenvoucherstatus=[];
	 $scope.statusCheque = ["Pending","Realized","Presented","Bounced","Returned"];
	 $scope.checkedcustcheque=[];
	 $scope.checkedvencheque=[];
	$scope.navVoucherRedirect =function(event){
		 $(".nav").find(".active").removeClass("active");
		   $(event).addClass("active");
		   var currEvent=$(event.target).attr('bind-attr');
		  if(currEvent =="customerCredit"){
			  $('#customerCredit').show();
			  $('#vendorCredit').hide();
			  $('#customerCheque').hide();
			   $('#vendorCheque').hide();
			   $scope.initcustList();
			  // $scope.init_custCredit();
				//$scope.init_custCreditStatus();
		  }else if(currEvent =="vendorCredit"){
			  $('#customerCredit').hide();
			  $('#vendorCredit').show();
			  $('#customerCheque').hide();
			   $('#vendorCheque').hide();
			   $scope.initvenList();
			  // $scope.init_venCredit();
				//$scope.init_venCreditStatus();
		  }else if(currEvent =="customerCheque"){
			  $('#customerCredit').hide();
			  $('#vendorCredit').hide();
			  $('#customerCheque').show();
			   $('#vendorCheque').hide();
			   $scope.init_custChequeStatus();
		  }else if(currEvent =="vendorCheque"){
			  $('#customerCredit').hide();
			  $('#vendorCredit').hide();
			  $('#customerCheque').hide();
			   $('#vendorCheque').show();
			   $scope.init_venChequeStatus();
		  }
	}
	
	 $scope.searchcustCreditItem =function(custName){
		 $scope.commoncustMatches={totalcreditamount:0,totalotheramount:0};
			if(custName !="" || custName != undefined){
				var url=localurl +"/api/v1/findcustomer/"+custName;
				 $http({
					    method : 'GET',
					    url : url/* ,
					    params: {name: custName} */
					   }).then(function successCallback(response) {
					   $scope.custCreditList = response.data;
					   }, function errorCallback(response) {
					    console.log(response.statusText);
					   });
			}else{
				toastr.success('Please Select Customer Name..');
			}
			
		};
		
		/* $scope.greaterThan = function(prop, val){
		    return function(pay){
		      if (pay[prop] > val) return true;
		    }
		  } */
		  $scope.nonCredit = function (pay) {
			  if(pay.paymenttype !="Credit"){
				  if(pay.status =="Paid" || pay.status =="Realized"){
					  return (pay.balanceamount > 0);
				  }
			  }
			    
			}
		$scope.greaterThan = function (pay) {
			if(pay.paymenttype =="Credit"){
				return (pay.balanceamount > 0);
			}
		    
		}
		 $scope.custChequeFilter= function (custcheque) {
			if(custcheque.paymenttype =="Cheque" || custcheque.paymenttype =="DD"){
				if(custcheque.status =="Pending" || custcheque.status =="Presentated"){
					return true;
				}
				
			}
		} 
		 
		 $scope.venChequeFilter= function (vencheque) {
				if(vencheque.paymenttype =="Cheque" || vencheque.paymenttype =="DD"){
					if(vencheque.status =="Pending" || vencheque.status =="Presentated"){
						return true;
					}
					
				}
			} 
		
		$scope.searchvenCreditItem =function(venName){
			 $scope.commonvenMatches={totalcreditamount:0,totalotheramount:0};
			if(venName !="" || venName != undefined){
				var url=localurl +"/api/v1/vendorname/"+venName;
				 $http({
					    method : 'GET',
					    url : url
					   }).then(function successCallback(response) {
					   $scope.venCreditList = response.data;
					   }, function errorCallback(response) {
					    console.log(response.statusText);
					   });
			}else{
				toastr.success('Please Select Vendor Name..');
			}
			
		};
	
	 $scope.checkcustVoucherInArray =function(index,item){
		 
		 angular.forEach($scope.custCreditList,function(list){
		        if(list != item){
		            list.checked = false;
		        }
		    })
		 
		 if(item.checked) {
		      $scope.checkedcustvoucher.push(item);
		    } else {
		       var newIndex = $scope.checkedcustvoucher.map(function(e) { return e.childcustomerpaymentid; }).indexOf(item.childcustomerpaymentid);
		       // for compare instead of "loadNo" you should use that field is unique. ie: e.uniqueField
		       // and $scope.customerInvoiceJson[index].uniqueField
		       if(newIndex !== -1)
		          $scope.checkedcustvoucher.splice(newIndex,1);
		    }
	 }
	 
	 
$scope.checkvenVoucherInArray =function(index,item){
		 
		 angular.forEach($scope.venCreditList,function(list){
		        if(list != item){
		            list.checked = false;
		        }
		    })
		 
		 if(item.checked) {
		      $scope.checkedvenvoucher.push(item);
		    } else {
		       var newIndex = $scope.checkedvenvoucher.map(function(e) { return e.vendorpaymentid; }).indexOf(item.vendorpaymentid);
		       // for compare instead of "loadNo" you should use that field is unique. ie: e.uniqueField
		       // and $scope.customerInvoiceJson[index].uniqueField
		       if(newIndex !== -1)
		          $scope.checkedvenvoucher.splice(newIndex,1);
		    }
	 }
	
	  $scope.checkcustChequeInArray =function(index,item){
		 if(item.checked) {
		      $scope.checkedcustcheque.push(item);
		    } else {
		       var newIndex = $scope.checkedcustcheque.map(function(e) { return e.childcustomerpaymentid; }).indexOf(item.childcustomerpaymentid);
		       if(newIndex !== -1)
		          $scope.checkedcustcheque.splice(newIndex,1);
		    }
	 } 
	  
	  $scope.checkvenChequeInArray =function(index,item){
			 if(item.checked) {
			      $scope.checkedvencheque.push(item);
			    } else {
			       var newIndex = $scope.checkedvencheque.map(function(e) { return e.vendorpaymentid; }).indexOf(item.vendorpaymentid);
			       if(newIndex !== -1)
			          $scope.checkedvencheque.splice(newIndex,1);
			    }
		 } 
	
	 $scope.makecustMatches =function(){
		 $scope.totaltempamount=0;
		 $scope.totaltempId=[];
	 		$scope.commoncustMatches={totalcreditamount:0,totalotheramount:0};
	 	var keepGoing = true;
	 		angular.forEach($scope.checkedcustvoucher, function(value, key) {
	 			if(value.checked){
	 				$scope.commoncustMatches.totalcreditamount +=parseInt(value.balanceamount)?parseInt(value.balanceamount):0;
	 			}
			});
	 		
	 		angular.forEach($scope.custCreditList, function(value, key) {
	 			if(value.paymenttype !="Credit"){
	 			if(keepGoing) {
	 				$scope.totaltempamount +=parseInt(value.balanceamount)?parseInt(value.balanceamount):0;
	 				$scope.totaltempId.push(value.childcustomerpaymentid);
	 			if($scope.commoncustMatches.totalcreditamount <= $scope.totaltempamount){
	 				$scope.commoncustMatches.totalotheramount =$scope.totaltempamount;
	 				
 				keepGoing = false;
	 			}
	 			}
	 			}
		});
	 		
	 	}
	 
	 $scope.makevenMatches =function(){
		 $scope.totalventempamount=0;
		 $scope.totalventempId=[];
	 		$scope.commonvenMatches={totalcreditamount:0,totalotheramount:0};
	 	var keepGoingven = true;
	 		angular.forEach($scope.checkedvenvoucher, function(value, key) {
	 			if(value.checked){
	 				$scope.commonvenMatches.totalcreditamount +=parseInt(value.balanceamount)?parseInt(value.balanceamount):0;
	 			}
			});
	 		
	 		angular.forEach($scope.venCreditList, function(value, key) {
	 			if(value.paymenttype !="Credit"){
	 			if(keepGoingven) {
	 				$scope.totalventempamount +=parseInt(value.balanceamount)?parseInt(value.balanceamount):0;
	 				$scope.totalventempId.push(value.vendorpaymentid);
	 			if($scope.commonvenMatches.totalcreditamount <= $scope.totalventempamount){
	 				$scope.commonvenMatches.totalotheramount =$scope.totalventempamount;
	 				
 				keepGoingven = false;
	 			}
	 			}
	 			}
		});
	 		
	 	}
	 
	 $scope.checkandSave =function(){
		 $scope.updatecustVoucher=[];
		 $scope.debitBalance=($scope.commoncustMatches.totalotheramount)-($scope.commoncustMatches.totalcreditamount);
		 if($scope.commoncustMatches.totalcreditamount <= $scope.commoncustMatches.totalotheramount && $scope.commoncustMatches.totalcreditamount ){
	 		angular.forEach($scope.custCreditList, function(value, key) {
	 			if(value.paymenttype !="Credit"){
	 			angular.forEach($scope.totaltempId, function(item, i,array) {
	 				//console.log(item +""+i+""+array.length - 1);
	 				 if(value.childcustomerpaymentid == item){
	 					value.balanceamount=0;
	 					$scope.updatecustVoucher.push(value);
			 			}
	 				 if(value.childcustomerpaymentid == array[array.length-1]){
	 					value.balanceamount=$scope.debitBalance;
		 			}
	 			});
	 			}
			});
	 		angular.forEach($scope.checkedcustvoucher, function(value, key) {
	 			//value.instrumentno=angular.$$stringify($scope.totaltempId);
	 			value.instrumentno=$scope.totaltempId.map(function(obj){return obj;}).join(','); 
	 			if(value.checked){
	 				value.balanceamount=0;	
	 			}
	 			$scope.updatecustVoucher.push(value);
			});
	 		
	 		//$scope.updatecustVoucher.push($scope.checkedcustvoucher);
	 		var url = localurl +"/api/v1/updatecustomerpaymentchild";
		    $http({
		        method : 'PUT',
		        url : url,
		        data : angular.toJson($scope.updatecustVoucher),
		        headers : {
		        'Content-Type' : 'application/json'
		        }
		        }).then(function (response) {
		            toastr.success("Updated successfully");
		            $scope.searchcustCreditItem($scope.customerVoucher.customername);
		        }, function error(response) {
		        	toastr.error('Error while Updating..');
		          console.log(response.status);
		        });
	 		
		 }else{
			toastr.warning("Credit and Debit Balance not matching");
		 }
	 }
	 
	 
	 $scope.checkandSavevendor =function(){
		 $scope.updatevenVoucher=[];
		 $scope.debitvenBalance=($scope.commonvenMatches.totalotheramount)-($scope.commonvenMatches.totalcreditamount);
		 if($scope.commonvenMatches.totalcreditamount <= $scope.commonvenMatches.totalotheramount && $scope.commonvenMatches.totalcreditamount ){
			 
	 		angular.forEach($scope.venCreditList, function(value, key) {
	 			angular.forEach($scope.totalventempId, function(item, i,array) {
	 				console.log(item +""+i+""+array.length - 1);
	 				 if(value.vendorpaymentid == item){
	 					$scope.updatevenVoucher.push(value);
	 					value.balanceamount=0;
			 			}
	 				 if(value.vendorpaymentid == array[array.length-1]){
	 					value.balanceamount=$scope.debitvenBalance;
		 			}
	 			});
		});
	 		
	 		angular.forEach($scope.checkedvenvoucher, function(value, key) {
				// value.instrumentno=$scope.totalventempId;
				 value.instrumentno=$scope.totalventempId.map(function(obj){return obj;}).join(','); 
	 			if(value.checked){
	 				value.balanceamount=0;	
	 			}
	 			$scope.updatevenVoucher.push(value);
			});
	 		
	 		
	 		var url = localurl +"/api/v1/updatevendorpaymentchild";
		    $http({
		        method : 'PUT',
		        url : url,
		        data : angular.toJson($scope.updatevenVoucher),
		        headers : {
		        'Content-Type' : 'application/json'
		        }
		        }).then(function (response) {
		            toastr.success("Updated successfully");
		            $scope.searchvenCreditItem($scope.vendorVoucher.vendorname);
		        }, function error(response) {
		        	toastr.error('Error while Updating..');
		          console.log(response.status);
		        });
		 }else{
			toastr.warning("Credit and Debit Balance not matching");
		 }
	 }
	 
	 
	 
	 $scope.submitcustCheque =function(){
		 if($scope.checkedcustcheque.length != 0){
			 var url=localurl +"/api/v1/updatecutomercheques";
			 $http({
				    method : 'PUT',
				    url : url,
				    data : angular.toJson($scope.checkedcustcheque),
			        headers : {
			        'Content-Type' : 'application/json'
			        }
				   }).then(function successCallback(response) {
				  // $scope.custCreditList = response.data;
				  toastr.success("Update Successfully");
					$scope.init_custChequeStatus();
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		 }else{
			 toastr.error("Please Check and Proceed");
		 }
		};
		
		$scope.submitvenCheque =function(){
			 if($scope.checkedvencheque.length != 0){
				 var url=localurl +"/api/v1/updatevendorchequelist";
				 $http({
					    method : 'PUT',
					    url : url,
					    data : angular.toJson($scope.checkedvencheque),
				        headers : {
				        'Content-Type' : 'application/json'
				        }
					   }).then(function successCallback(response) {
					  // $scope.custCreditList = response.data;
					   toastr.success("Update Successfully");
						   $scope.init_venChequeStatus();
					   }, function errorCallback(response) {
					    console.log(response.statusText);
					   });
			 }else{
				 toastr.error("Please Check and Proceed");
			 }
			};
	$scope.init_custChequeStatus =function(){
		 $scope.custChequeList =[];
			var url=localurl +"/api/v1/customerchequelist";
			 $http({
				    method : 'GET',
				    url : url
				   }).then(function successCallback(response) {
				   $scope.custChequeList = response.data;
				   $scope.checkedcustcheque=[];
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		};
		
		
		/* $scope.init_venCredit =function(){
			 $scope.venCreditList =[];
				var url=localurl +"/api/v1/vendorpaymentbystatusamount";
				 $http({
					    method : 'GET',
					    url : url
					   }).then(function successCallback(response) {
					   $scope.venCreditList = response.data;
					   }, function errorCallback(response) {
					    console.log(response.statusText);
					   });
			}; */
		$scope.init_venChequeStatus =function(){
			 $scope.venChequeList =[];
				var url=localurl +"/api/v1/vendorchequelist";
				 $http({
					    method : 'GET',
					    url : url
					   }).then(function successCallback(response) {
					   $scope.venChequeList = response.data;
					   $scope.checkedvencheque=[];
					   }, function errorCallback(response) {
					    console.log(response.statusText);
					   });
			};
		 $scope.initcustList =function(){
			 
			 var url=localurl +"/api/v1/customerlist";
			 $http({
				    method : 'GET',
				    url : url,
				   }).then(function successCallback(response) {
				   $scope.customerVoucherList = response.data;
				   $scope.checkedcustvoucher=[];
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		 }
		 $scope.initvenList =function(){
			 var url=localurl +"/api/v1/vendorlist";
			 $http({
				    method : 'GET',
				    url : url,
				   }).then(function successCallback(response) {
				   $scope.vendorVoucherList = response.data;
				   $scope.checkedvenvoucher=[];
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		}
	 $scope.initcustList();
	//$scope.init_custCredit();
	//$scope.init_custCreditStatus();
	scope=$scope;
});

app.controller('LedgerController', function ($scope,$timeout,$http,toastr,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder) {
	 $scope.initLedger =function(){
		 $('#datetimepicker_customerfromledge').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $('#datetimepicker_customertoledge').datetimepicker({
		        format: 'DD/MM/YYYY'
		    });
		 $scope.getLedger();
	 }
	 
	$scope.getLedger =function(){
		//$scope.ledger={fromdate:"",todate:"",customername:""};
    	$scope.ledgerListitem=[];
    	//$scope.commonmpList={custreceiptDate:"",totalamount:0};
		 //$scope.customervendorpayList=[];
		 var url=localurl +"/api/v1/combinenameslist";
		 $http({
			    method : 'GET',
			    url : url,
			   }).then(function successCallback(response) {
			   //$scope.listCustJson = response.data;
			   angular.forEach(response.data,function(value,index){
				   if(value.customername || value.vendorname){
					   $scope.ledgerListitem.push(value.customername ? value.customername : value.vendorname);  
				   }
				   
			   });
			   }, function errorCallback(response) {
			    console.log(response.statusText);
			   });
	}
	$scope.searchLedgerItem =function(){
		if($scope.ledger.fromdate=="" || $scope.ledger.fromdate== undefined){
			 toastr.error('Please enter From date');
			return;
		}else if($scope.ledger.todate=="" || $scope.ledger.todate==undefined){
			 toastr.error('Please enter To date');
			return;
		}else if($scope.ledger.custvendorname=="" || $scope.ledger.custvendorname== undefined){
			 toastr.error('Please enter CustomerName');
			return;
		}else{
			var url=localurl +"/api/v1/ledgerreportform";
			 $http({
				    method : 'GET',
				    url : url,
				    params: $scope.ledger,
				   }).then(function successCallback(response) {
				   $scope.ledgerList = response.data;
				   }, function errorCallback(response) {
				    console.log(response.statusText);
				   });
		}
		
	};
	$scope.navLedgerRedirect =function(event){
		 $(".nav").find(".active").removeClass("active");
		   $(event).addClass("active");
		   var currEvent=$(event.target).attr('bind-attr');
		  if(currEvent =="ledger"){
			  $('#ledger').show(); 
			
		  }
	}
	  $scope.initLedger();
	  scope=$scope;
});
$(document).ready(function(){

	$(".menu-toggle").click(function(e) {
        e.preventDefault();
        $("#wrapper").toggleClass("active");
	});
	// $('#datetimepicker_gateIn').datetimepicker();
	/*  $('#datetimepicker_gateIn').on('dp.change', function (e) {
        $('#datetimepicker_gateOut').data("DateTimePicker").minDate(e.date);
    }); */  
    /*   $("#startdate").datetimepicker({
    todayBtn:  1,
    autoclose: true,
}).on('changeDate', function (selected) {
    var minDate = new Date(selected.date.valueOf());
    $('#enddate').datepicker('setStartDate', minDate);
});  */ 
	

});

var a = ['','One ','Two ','Three ','Four ', 'Five ','Six ','Seven ','Eight ','Nine ','Ten ','Eleven ','Twelve ','Thirteen ','Fourteen ','Fifteen ','Sixteen ','Seventeen ','Eighteen ','Nineteen '];
var b = ['', '', 'Twenty','Thirty','Forty','Fifty', 'Sixty','Seventy','Eighty','Ninety'];

function inWords (num) {
    if ((num = num.toString()).length > 9) return 'overflow';
    n = ('000000000' + num).substr(-9).match(/^(\d{2})(\d{2})(\d{2})(\d{1})(\d{2})$/);
    if (!n) return; var str = '';
    str += (n[1] != 0) ? (a[Number(n[1])] || b[n[1][0]] + ' ' + a[n[1][1]]) + 'crore ' : '';
    str += (n[2] != 0) ? (a[Number(n[2])] || b[n[2][0]] + ' ' + a[n[2][1]]) + 'lakh ' : '';
    str += (n[3] != 0) ? (a[Number(n[3])] || b[n[3][0]] + ' ' + a[n[3][1]]) + 'thousand ' : '';
    str += (n[4] != 0) ? (a[Number(n[4])] || b[n[4][0]] + ' ' + a[n[4][1]]) + 'hundred ' : '';
    str += (n[5] != 0) ? ((str != '') ? 'and ' : '') + (a[Number(n[5])] || b[n[5][0]] + ' ' + a[n[5][1]]) + 'only ' : '';
    return str;
}

app.directive('startdatetimepicker', function () {
    /* return {
        restrict: 'A',
        require : 'ngModel',
        link : function (scope, element, attrs, ngModelCtrl) {

            element.datetimepicker({
                change:function (date) {

                    // Triggers a digest to update your model
                    scope.$apply(function () {
                        ngModelCtrl.$setViewValue(date);
                    });

                }
            });
        }
    }  */
	return {
	      restrict: 'A',
	      link: postLink,
	      require: 'ngModel'
	    };
	    function postLink(scope, element, attr, ngModel) {
	        var ignoreChangeEvent = false;
	        element.datetimepicker();
	        element.on('dp.change', function(event) {
	            console.log("dp.change",event.date);
	            console.log(event);
	            if (ignoreChangeEvent) {
	              ignoreChangeEvent = false;
	              return;
	            }
	            //console.dir(date);
	            scope.$apply(function() {
	              ngModel.$setViewValue(event.date);
	            });
	        });
	        ngModel.$formatters.push(function (date) {
	            console.log("format", date);
	            ignoreChangeEvent = true;
	           // element.data("DateTimePicker").setStartDate(date);
	            $("#datetimepicker_gateIn").datetimepicker('setStartDate', date);
	        });
	      }
});

app.directive("panRegex", function() {

    var regexp;
    return {
        restrict: "A",
        link: function(scope, elem, attrs) {
            //regexp = /^([a-zA-Z]){5}([0-9]){4}([a-zA-Z]){1}$/;
            regexp = /^([a-zA-Z]([a-zA-Z]([a-zA-Z]([a-zA-Z]([a-zA-Z]([0-9]([0-9]([0-9]([0-9]([a-zA-Z])?)?)?)?)?)?)?)?)?)?$/;
            var char;
            elem.bind("keypress", function(event) {
                char = String.fromCharCode(event.which)
                console.log(elem.val() + char);
                if(!regexp.test(elem.val() + char))
                    event.preventDefault();
            })
        }
    }

});

app.directive("numericRegex", function() {

    var regexp;
    return {
        restrict: "A",
        link: function(scope, elem, attrs) {
            regexp = /^([0-9]){0,10}$/;
            var char;
            elem.bind("keypress", function(event) {
                char = String.fromCharCode(event.which)
                if(!regexp.test(elem.val() + char))
                    event.preventDefault();
            })
        }
    }

});

app.directive('initialDate', function () {
    return {
      link: function (scope, elem, attrs, ctrl) {
    	  console.log("hello");
    	 // $scope.initdate = function () {
    			$('#datetimepicker_fc').datetimepicker({
    			    format: 'DD/MM/YYYY'
    			});
    			$('#datetimepicker_ins').datetimepicker({
    			    format: 'DD/MM/YYYY'
    			});
    		//};
        /* var hello = function () {
          for (var i = 0; i < attrs.repeatHelloWorld; i++) {
            console.log('Hello world!');
          }
        }
        hello(); */
      }
    }
  });
  
app.directive("stateValid", function() {

    var regexp;
    return {
        restrict: "A",
        link: function(scope, elem, attrs) {
           // regexp = /^([0-9]){0,10}$/;
           // var char;
            elem.bind("blur", function(event) {
            console.log(event);	
            
                /* char = String.fromCharCode(event.which)
                if(!regexp.test(elem.val() + char))
                    event.preventDefault(); */
            })
        }
    }

});
app.directive('fileModel', ['$parse', function($parse){
    return {
        restrict: 'A',
        link: function(scope, element,attrs) {
            var model = $parse(attrs.fileModel);
            var modelSetter = model.assign;

            element.bind('change', function() {
                scope.$apply(function() {
                    modelSetter(scope, element[0].files[0]);
                })
            })
        }
    }
}]);

app.service('multipartForm', ['$http', function($http,$scope){
    this.post = function(uploadUrl, data) {
	    	var formData = new FormData();
	    	formData.append("file", data);
	    	jQuery.ajax({
	    	    url: uploadUrl,
	    	    data: formData,
	    	    cache: false,
	    	    contentType: false,
	    	    processData: false,
	    	    method: 'POST',
	    	    success: function(data){
	    	       scope.tripListPending=data;
	    	       $("#tripfile").val("");
	    	       $("#myuploadModal").modal("show");
	    	       scope.closeUpload();
	    	       scope.$digest();
	    	    }
	    	});
        }
}])
 /* function RowSelect($compile,$scope,$resource,$location, $q,$timeout,DTOptionsBuilder, DTColumnBuilder, DTColumnDefBuilder){
	 $scope.customerInvoiceJson =[{id:"1",LRNO: "23678",date: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckNo: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opKms:"678",clsKms:"788",totalkms: "100", forKms: "330", tRTypeFixed: "2000",advance:"",grandTotal:""},
									{id:"2",LRNO: "2008",date: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckNo: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opKms:"678",clsKms:"788",totalkms: "100", forKms: "330", tRTypeFixed: "1000",advance:"500",grandTotal:""},
									{id:"3",LRNO: "2998",date: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckNo: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opKms:"678",clsKms:"788",totalkms: "100", forKms: "330", tRTypeFixed: "500",advance:"",grandTotal:""},
									{id:"4",LRNO: "23678",date: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckNo: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opKms:"678",clsKms:"788",totalkms: "100", forKms: "330", tRTypeFixed: "2000",advance:"100",grandTotal:""},
									{id:"5",LRNO: "20002",date: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckNo: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opKms:"678",clsKms:"788",totalkms: "100", forKms: "330", tRTypeFixed: "400",advance:"",grandTotal:""},
									{id:"6",LRNO: "23",date: "1-Apr-2019", invoiceNo: "7345300022", origin: "NEMAM",customerName:"HCCBPL REDHILLS DEPOT",destination:"POOCHIATHIPATTU",truckNo: "TN3QU2333", truckType: "TRS", noOfCase: "1123",opKms:"678",clsKms:"788",totalkms: "100", forKms: "330", tRTypeFixed: "3000",advance:"400",grandTotal:""}];	
	 var bm = $scope;
	 bm.selected = {};
	 bm.selectAll = false;
	 bm.toggleAll = toggleAll;
	 bm.toggleOne = toggleOne;
	 bm.dtInstance = {};
	 
	 
	
	 
	 var titleHtml = '<input type="checkbox" ng-model="bm.selectAll" ng-click="bm.toggleAll(bm.selectAll,bm.selected)">';

		//$scope.bm.dtOptions = DTOptionsBuilder.newOptions()
		bm.dtOptions = DTOptionsBuilder.fromFnPromise(function() {
			
			 var defer = $q.defer();
	        defer.resolve($scope.customerInvoiceJson);
	        return defer.promise; 
            return $resource($scope.customerInvoiceJson).query().$promise;
        })
         .withOption('createdRow', function(row, data, dataIndex) {
            // Recompiling so we can bind Angular directive to the DT
            $compile(angular.element(row).contents())($scope);
        })
        	.withOption('headerCallback', function(header) {
            if (!bm.headerCompiled) {
                // Use this headerCompiled field to only compile header once
                bm.headerCompiled = true;
                $compile(angular.element(header).contents())($scope);
            }
        })
		        .withOption('scrollY', '300px')
		        .withOption('scrollX', '100%')
		        .withOption('scrollCollapse', true)
		        .withFixedColumns({
		            leftColumns: 1,
		            rightColumns: 1
		        });
	
		 bm.dtColumns = [
	        DTColumnBuilder.newColumn(null).withTitle(titleHtml).notSortable()
	            .renderWith(function(data, type, full, meta) {
	            	bm.selected[full.id] = false;
	                return '<input type="checkbox" ng-model="bm.selected[' + data.id + ']" ng-click="bm.toggleOne(bm.selected)">';
	            }), 
	            DTColumnBuilder.newColumn('LRNO').withTitle('LRNO'),
	            DTColumnBuilder.newColumn('date').withTitle('Date'),
	            DTColumnBuilder.newColumn('invoiceNo').withTitle('InvoiceNo'),
	            DTColumnBuilder.newColumn('origin').withTitle('Origin'),
	            DTColumnBuilder.newColumn('customerName').withTitle('CustomerName'),
	            DTColumnBuilder.newColumn('destination').withTitle('Destination'),
	            DTColumnBuilder.newColumn('truckNo').withTitle('TruckNo'),
	            DTColumnBuilder.newColumn('truckType').withTitle('TruckType'),
	            DTColumnBuilder.newColumn('noOfCase').withTitle('No of case'),
	            DTColumnBuilder.newColumn('opKms').withTitle('OP Kms'),
	            DTColumnBuilder.newColumn('clsKms').withTitle('Cls Kms'),
	            DTColumnBuilder.newColumn('totalkms').withTitle('Total kms'),
	            DTColumnBuilder.newColumn('forKms').withTitle('For Kms'),
	            DTColumnBuilder.newColumn('tRTypeFixed').withTitle('TRTypeFixed'),
	            DTColumnBuilder.newColumn('advance').withTitle('Advance')
	    ]; 
		 function toggleAll(selectAll, selectedItems) {
		        for (var id in selectedItems) {
		            if (selectedItems.hasOwnProperty(id)) {
		                selectedItems[id] = selectAll;
		            }
		        }
		    }
		 function toggleOne(selectedItems) {
		        for (var id in selectedItems) {
		            if (selectedItems.hasOwnProperty(id)) {
		                if(!selectedItems[id]) {
		                	bm.selectAll = false;
		                    return;
		                }
		            }
		        }
		        bm.selectAll = true;
		    }
}  */
</script>
</body>
</html>